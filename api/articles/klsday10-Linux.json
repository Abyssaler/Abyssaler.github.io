{"title":"Linux-iptables防火墙-klsday10","uid":"a83094df2fe1f1931833ffcbbd33f63b","slug":"klsday10-Linux","date":"2023-05-29T00:54:56.229Z","updated":"2023-05-30T14:19:50.864Z","comments":true,"path":"api/articles/klsday10-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-exzzjo.jpg","content":"<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529090153534.png\" alt=\"image-20230529090153534\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529100626585.png\" alt=\"image-20230529100626585\"></p>\n<h2 id=\"iptables基础规则\"><a href=\"#iptables基础规则\" class=\"headerlink\" title=\"iptables基础规则\"></a>iptables基础规则</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529100703963.png\" alt=\"image-20230529100703963\"></p>\n<h3 id=\"Linux防火墙基础\"><a href=\"#Linux防火墙基础\" class=\"headerlink\" title=\"Linux防火墙基础\"></a>Linux防火墙基础</h3><h4 id=\"包过滤防火墙概述\"><a href=\"#包过滤防火墙概述\" class=\"headerlink\" title=\"包过滤防火墙概述\"></a>包过滤防火墙概述</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529100719325.png\" alt=\"image-20230529090434202\"></p>\n<p>iptables其实不是真正的防火墙，更像一个客户端代理，通过客户端代理，将用户需要的安全设定或者说规则添加到对应的安全框架当中，这个安全框架才是真正的防火墙，也就是netfilter</p>\n<p>netfilter是基于包过滤的防火墙</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529090737593.png\" alt=\"image-20230529090737593\"></p>\n<h4 id=\"iptables的表，链，规则结构\"><a href=\"#iptables的表，链，规则结构\" class=\"headerlink\" title=\"iptables的表，链，规则结构\"></a>iptables的表，链，规则结构</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529090951000.png\" alt=\"image-20230529090951000\"></p>\n<p>防火墙结构：表&#x3D;&#x3D;&gt;链&#x3D;&#x3D;&gt;规则</p>\n<p>表：链的容器</p>\n<p>链：规则的容器</p>\n<p>规则：真正起作用的东西</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">INPUT：该规则链用于控制所有进入本地主机的数据包。例如，可以使用INPUT规则链来允许或拒绝SSH、HTTP、FTP等服务的访问请求。\n\nOUTPUT：该规则链用于控制所有从本地主机出去的数据包。例如，可以使用OUTPUT规则链来限制本地主机对外连接的目标IP地址和端口号。\n\nFORWARD：该规则链用于控制转发过来的数据包，即从一个网络接口输入，经过防火墙后从另一个网络接口输出的数据包。该规则链常用于路由器等设备上。\n\nPREROUTING：该规则链用于控制在数据包进入本地主机之前修改数据包头部信息。例如，可以使用PREROUTING规则链来实现端口映射、负载均衡等功能。\n\nPOSTROUTING：该规则链用于控制在数据包离开本地主机之前修改数据包头部信息。例如，可以使用POSTROUTING规则链来实现NAT网关、VPN隧道等功能。</code></pre>\n\n<p>大多数防护墙都是五表五链</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529102507010.png\" alt=\"image-20230529102507010\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">filter：filter表是iptables默认的表，用于过滤数据包。该表包含了三个主要的链：INPUT、FORWARD和OUTPUT。\n\nnat：nat表负责网络地址转换（Network Address Translation），例如IP地址和端口号的修改。该表包含了三个主要的链：PREROUTING、POSTROUTING和OUTPUT。\n\nmangle：mangle表用于对数据包的头部进行修改。该表包含了五个主要的链：PREROUTING、INPUT、FORWARD、OUTPUT和POSTROUTING。用于给数据包打标签\n\nraw：raw表被用于一些特定的需要完全访问原始数据包的场景。该表包含了两个主要的链：PREROUTING和OUTPUT。raw表 决定了是否对数据包进行跟踪，Linux中对数据包有连接跟踪机制，可以啊帮助操作系统掌握数据包的实时状态。在Linux系统中会有一个连接跟踪表，用于存放跟踪记录，这个表是会满的，一旦满了，会报错，会把包扔了，所以可以在raw表中可以设置需要记录哪些包，不需要记录哪些包，节省连接跟踪表的空间</code></pre>\n\n<p>用的比较多的是nat表和filter表</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529110054397.png\" alt=\"image-20230529110054397\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529092840706.png\" alt=\"image-20230529092840706\"></p>\n<p><code>iptables -t raw -L</code>查看raw表的链</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@mycentos ~]# iptables -t raw -L \nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination     </code></pre>\n\n<p>默认的表是filter表</p>\n<h4 id=\"匹配流程\"><a href=\"#匹配流程\" class=\"headerlink\" title=\"匹配流程\"></a>匹配流程</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529093812267.png\" alt=\"image-20230529093812267\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529104614024.png\" alt=\"image-20230529104614024\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Linux数据包过滤的匹配流程如下：\n\n1.数据包到达系统后，首先会经过PREROUTING链，此时数据包还没有被路由。\n2.在PREROUTING链中，iptables会按照预定义的规则表(filter、nat、mangle、raw)和用户定义的规则表（如果存在）进行匹配，判断是否需要对该数据包进行进一步处理。\n3.如果数据包被规则匹配并且需要被处理，那么数据包将被修改（如果需要）并根据路由表发往目标IP地址。\n4.如果目标主机与原始主机不在同一网络中，则数据包需要进行路由。此时，它会经过POSTROUTING链进行匹配处理。\n5.在POSTROUTING链中，iptables会根据规则表中的规则对数据包头进行修改，并将数据包发送到下一个路由器或目标主机。\n6.如果本地主机需要处理数据包，则数据包将进入INPUT链。\n7.在INPUT链中，iptables会根据规则表中的规则对数据包进行匹配处理，如果满足规则条件，则进行接收；否则将数据包丢弃或者发送相应的拒绝信息。\n8.如果数据包需要通过本地主机转发到其他主机，则会进入FORWARD链。\n9.在FORWARD链中，iptables会根据规则表中的规则对数据包进行匹配处理，如果满足规则条件，则进行转发；否则将数据包丢弃或者发送相应的拒绝信息。\n10.如果在一个链中没有匹配到任何规则，则由系统默认策略来处理该数据包。</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529133010383.png\" alt=\"image-20230529133010383\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529133059762.png\" alt=\"image-20230529133059762\"></p>\n<h3 id=\"编写防火墙规则\"><a href=\"#编写防火墙规则\" class=\"headerlink\" title=\"编写防火墙规则\"></a>编写防火墙规则</h3><p>写ACL的原则，越详细的越往策略的上面放（因为匹配到了即停止），越笼统的越往下放</p>\n<h4 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529112303766.png\" alt=\"image-20230529112303766\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529112720395.png\" alt=\"image-20230529112720395\"></p>\n<p>iptables&#x3D;&#x3D;&gt;指定表&#x3D;&#x3D;&gt;指定链&#x3D;&#x3D;&gt;指定对数据包的描述&#x3D;&#x3D;&gt;处理方式</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529134210815.png\" alt=\"image-20230529134210815\"></p>\n<p>用<code>-j</code>指定控制类型，如<code>-j DROP</code></p>\n<h4 id=\"管理选项\"><a href=\"#管理选项\" class=\"headerlink\" title=\"管理选项\"></a>管理选项</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529140142674.png\" alt=\"image-20230529140142674\"></p>\n<p>以数字信息查看详细信息：<code>iptables -L -nvx</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529135114692.png\" alt=\"image-20230529135114692\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">iptables几个常用选项：\n-A: add，表示添加一条规则。\n-D: delete，表示删除一条规则。\n-I: insert，表示插入一条规则到指定位置。\n-R: replace，表示替换指定位置的规则。\n-L: list，表示列出所有规则。\n-F: flush，表示清除所有规则。\n-P: policy，表示设置默认策略。\n-s: source，表示源IP地址或子网，可指定为单个IP地址或CIDR地址段。\n-d: destination，表示目标IP地址或子网，可指定为单个IP地址或CIDR地址段。\n-p: protocol，表示匹配协议类型，如TCP、UDP、ICMP等。\n--dport: destination port，表示目标端口号。\n--sport: source port，表示源端口号。\n-m: match，表示匹配扩展模块，如iprange、tcp、udp、icmp等。\n-j: jump，表示执行动作，如ACCEPT、REJECT、DROP、LOG等。</code></pre>\n\n<p><strong>如果在添加规则时没有指定表名，则默认情况下会将规则添加到filter表中的规则链上</strong></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529140659707.png\" alt=\"image-20230529140659707\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529141823461.png\" alt=\"image-20230529141823461\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529135751896.png\" alt=\"image-20230529135751896\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529140048956.png\" alt=\"image-20230529140048956\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529141921939.png\" alt=\"image-20230529141921939\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529143021544.png\" alt=\"image-20230529143021544\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529143048028.png\" alt=\"image-20230529143048028\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529143608267.png\" alt=\"image-20230529143608267\"></p>\n<h4 id=\"规则的匹配条件\"><a href=\"#规则的匹配条件\" class=\"headerlink\" title=\"规则的匹配条件\"></a>规则的匹配条件</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529143646495.png\" alt=\"image-20230529143646495\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529143739563.png\" alt=\"image-20230529143739563\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529144052173.png\" alt=\"image-20230529144052173\"></p>\n<p>ICMP类型</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529144541124.png\" alt=\"image-20230529144541124\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529144616465.png\" alt=\"image-20230529144616465\"></p>\n<p> 查看与自己通信过的主机的mac地址:<code>arp -a</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">iptables -m state命令使用state模块对连接进行状态跟踪，从而可以根据连接状态对数据包进行过滤和匹配。以下是一些常见的连接状态：\n\nNEW：表示这是一个新的连接请求，还没有建立连接。\nESTABLISHED：表示连接已经建立，可以正常传输数据。\nRELATED：表示连接已经建立，但与此连接相关的其他连接并不属于该连接的流量，比如FTP数据连接。\nINVALID：表示无效的连接，该连接没有经过正确的三次握手过程，可能是来自恶意攻击或者应用程序错误等。\nUNTRACKED：表示未跟踪的连接，即该连接没有被记录到连接跟踪表中。</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529150856060.png\" alt=\"image-20230529150856060\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529151819921.png\" alt=\"image-20230529151819921\"></p>\n<h2 id=\"防火墙实现SNAT和DNAT\"><a href=\"#防火墙实现SNAT和DNAT\" class=\"headerlink\" title=\"防火墙实现SNAT和DNAT\"></a>防火墙实现SNAT和DNAT</h2><p>SNAT：源地址转换</p>\n<p>DNAT：目的地址转换</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529152317223.png\" alt=\"image-20230529152317223\"></p>\n<h4 id=\"SNAT策略的应用\"><a href=\"#SNAT策略的应用\" class=\"headerlink\" title=\"SNAT策略的应用\"></a>SNAT策略的应用</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529152304752.png\" alt=\"image-20230529152304752\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529152601057.png\" alt=\"image-20230529152601057\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529152827067.png\" alt=\"image-20230529152827067\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529152859963.png\" alt=\"image-20230529152859963\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529154529220.png\" alt=\"image-20230529154529220\"></p>\n<p>实验</p>\n<p><strong>client{192.168.235.135}———–{192.168.235.136}ens33–iptables–ens34{192.168.2.110}———{192.168.2.237}web</strong></p>\n<p>#web</p>\n<p><code>tail -f /var/log/httpd/access_log</code></p>\n<p>#iptables</p>\n<p><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward   # 开启转发</code></p>\n<p><code>iptables -t nat -A POSTROUTING -s 192.168.235.0/24 -o ens33 -j SNAT --to-source 192.168.2.110</code></p>\n<p>#client</p>\n<p><code>route add default gw 192.168.235.136</code>将网关改为192.168.235.136</p>\n<p><code>curl 192.168.2.237</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529164723285.png\" alt=\"image-20230529164723285\"></p>\n<p>代理成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529211213513.png\" alt=\"image-20230529211213513\"></p>\n<p><code>iptables -t nat -A POSTROUTING -s 192.168.235.0/24 -o ens33 -j MASQUERADE</code></p>\n<h4 id=\"DANT策略的应用\"><a href=\"#DANT策略的应用\" class=\"headerlink\" title=\"DANT策略的应用\"></a>DANT策略的应用</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529211729476.png\" alt=\"image-20230529211729476\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529211800410.png\" alt=\"image-20230529211800410\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529211827688.png\" alt=\"image-20230529211827688\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529212902473.png\" alt=\"image-20230529212902473\"></p>\n<p><strong>client(waiwang){192.168.235.135}———–{192.168.235.136}ens33–iptables–ens34{192.168.2.110}———{192.168.2.237}web(neiwang)</strong></p>\n<p>neiwang:</p>\n<p><code>route add default gw 192.168.2.110</code></p>\n<p><code>systemctl restart httpd</code></p>\n<p><code>tail -f /var/log/httpd/access_log</code></p>\n<p>iptables:</p>\n<p><code>iptables -t nat -F</code></p>\n<p><code>iptables -t nat -A PREROUTING -i ens33 -d 192.168.235.136 -p tcp --dport 80 -j DNAT --to-destination 192.168.2.237</code></p>\n<p>waiwang:</p>\n<p><code>route del default gw 192.168.235.136</code></p>\n<p><code>curl 192.168.2.237</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529230410212.png\" alt=\"image-20230529230410212\"></p>\n<h2 id=\"firewalld基础规则\"><a href=\"#firewalld基础规则\" class=\"headerlink\" title=\"firewalld基础规则\"></a>firewalld基础规则</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529231021894.png\" alt=\"image-20230529231021894\"></p>\n<h3 id=\"firewalld基础\"><a href=\"#firewalld基础\" class=\"headerlink\" title=\"firewalld基础\"></a>firewalld基础</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529231037379.png\" alt=\"image-20230529231037379\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529231213465.png\" alt=\"image-20230529231213465\"></p>\n<p>图形界面操作</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529232056560.png\" alt=\"image-20230529232056560\"></p>\n<h3 id=\"firewall-cmd命令\"><a href=\"#firewall-cmd命令\" class=\"headerlink\" title=\"firewall-cmd命令\"></a>firewall-cmd命令</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529232217390.png\" alt=\"image-20230529232217390\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529232451774.png\" alt=\"image-20230529232451774\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529233146600.png\" alt=\"image-20230529233146600\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529233420244.png\" alt=\"image-20230529233420244\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230529233446584.png\" alt=\"image-20230529233446584\"></p>\n<ul>\n<li><code>--reload</code>：重新加载防火墙规则，在文件 <code>/etc/firewalld/firewalld.conf</code> 中应用最新的配置更改，但不会重启防火墙服务。</li>\n<li><code>--permanent</code>：对配置进行永久性修改，将规则添加到永久性防火墙规则中。</li>\n<li><code>--runtime-to-permanent</code>：将当前运行时状态的防火墙规则应用到永久性防火墙规则中。</li>\n</ul>\n<h2 id=\"firewalld实现SNAT和DNAT\"><a href=\"#firewalld实现SNAT和DNAT\" class=\"headerlink\" title=\"firewalld实现SNAT和DNAT\"></a>firewalld实现SNAT和DNAT</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530083311740.png\" alt=\"image-20230530083311740\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530083456099.png\" alt=\"image-20230530083456099\"></p>\n<h3 id=\"SNAT\"><a href=\"#SNAT\" class=\"headerlink\" title=\"SNAT\"></a>SNAT</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530084422451.png\" alt=\"image-20230530084422451\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530084745601.png\" alt=\"image-20230530084745601\"></p>\n<p> <img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530084940677.png\" alt=\"image-20230530084940677\"></p>\n<h3 id=\"DNAT\"><a href=\"#DNAT\" class=\"headerlink\" title=\"DNAT\"></a>DNAT</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530090457479.png\" alt=\"image-20230530090457479\"></p>\n<h3 id=\"富语言规则\"><a href=\"#富语言规则\" class=\"headerlink\" title=\"富语言规则\"></a>富语言规则</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530091153950.png\" alt=\"image-20230530091153950\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530091225914.png\" alt=\"image-20230530091225914\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530091307380.png\" alt=\"image-20230530091307380\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530091312123.png\" alt=\"image-20230530091312123\"></p>\n","text":" iptables基础规则 Linux防火墙基础包过滤防火墙概述 iptables其实不是真正的防火墙，更像一个客户端代理，通过客户端代理，将用户需要的安全设定或者说规则添加到对应的安全框架当中，这个安全框架才是真正的防火墙，也就是netfilter netfilter是基于包过...","link":"","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":26,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":13,"path":"api/tags/kls.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#iptables%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99\"><span class=\"toc-text\">iptables基础规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80\"><span class=\"toc-text\">Linux防火墙基础</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8C%85%E8%BF%87%E6%BB%A4%E9%98%B2%E7%81%AB%E5%A2%99%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">包过滤防火墙概述</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#iptables%E7%9A%84%E8%A1%A8%EF%BC%8C%E9%93%BE%EF%BC%8C%E8%A7%84%E5%88%99%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">iptables的表，链，规则结构</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8C%B9%E9%85%8D%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">匹配流程</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%96%E5%86%99%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99\"><span class=\"toc-text\">编写防火墙规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">基本语法</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%AE%A1%E7%90%86%E9%80%89%E9%A1%B9\"><span class=\"toc-text\">管理选项</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%A7%84%E5%88%99%E7%9A%84%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6\"><span class=\"toc-text\">规则的匹配条件</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%9E%E7%8E%B0SNAT%E5%92%8CDNAT\"><span class=\"toc-text\">防火墙实现SNAT和DNAT</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#SNAT%E7%AD%96%E7%95%A5%E7%9A%84%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">SNAT策略的应用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DANT%E7%AD%96%E7%95%A5%E7%9A%84%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">DANT策略的应用</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#firewalld%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99\"><span class=\"toc-text\">firewalld基础规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#firewalld%E5%9F%BA%E7%A1%80\"><span class=\"toc-text\">firewalld基础</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#firewall-cmd%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">firewall-cmd命令</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#firewalld%E5%AE%9E%E7%8E%B0SNAT%E5%92%8CDNAT\"><span class=\"toc-text\">firewalld实现SNAT和DNAT</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SNAT\"><span class=\"toc-text\">SNAT</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DNAT\"><span class=\"toc-text\">DNAT</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%8C%E8%AF%AD%E8%A8%80%E8%A7%84%E5%88%99\"><span class=\"toc-text\">富语言规则</span></a></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"docker容器-klsday11","uid":"6a5c3f7124a5a7810eca7a15febbc057","slug":"klsday11-docker","date":"2023-05-30T01:05:21.661Z","updated":"2023-06-01T11:13:52.123Z","comments":true,"path":"api/articles/klsday11-docker.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-jx32vy.jpg","text":" docker容器技术 docker容器概述 yum install -y epel-release docker容器的应用阿里云镜像加速器 查看centos镜像的详细资料：docker search centos --no-trunc docker run -itd --nam...","link":"","photos":[],"count_time":{"symbolsCount":"9k","symbolsTime":"8 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":26,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":13,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"Linux-Shell脚本应用-klsday8","uid":"51f59f2591b85dbbff00c606d35a67d4","slug":"klsday8-Linux","date":"2023-05-24T01:32:40.926Z","updated":"2023-05-25T08:52:13.474Z","comments":true,"path":"api/articles/klsday8-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-xllp6l.jpg","text":" shell脚本应用（一）shell脚本简单介绍 bash 和 shell 是密切相关的概念。 shell 是指一种操作系统的命令行解释器，它充当用户与操作系统内核之间的接口。而 bash (Bourne-Again SHell) 则是一种 Unix&#x2F;Linux 操作系...","link":"","photos":[],"count_time":{"symbolsCount":"9.9k","symbolsTime":"9 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":26,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":13,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}