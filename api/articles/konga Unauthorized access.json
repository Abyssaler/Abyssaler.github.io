{"title":"Konga Unauthorized access","uid":"e30713b944030e046fa43cdfbe8c536f","slug":"konga Unauthorized access","date":"2023-08-06T07:30:46.647Z","updated":"2023-08-20T00:33:24.164Z","comments":true,"path":"api/articles/konga Unauthorized access.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-7p12xv.jpg","content":"<h1 id=\"Konga-Unauthorized-access-CVE-2023-39846\"><a href=\"#Konga-Unauthorized-access-CVE-2023-39846\" class=\"headerlink\" title=\"Konga Unauthorized access(CVE-2023-39846)\"></a>Konga Unauthorized access(CVE-2023-39846)</h1><h2 id=\"konga-introduce（konga-介绍）\"><a href=\"#konga-introduce（konga-介绍）\" class=\"headerlink\" title=\"konga introduce（konga 介绍）\"></a>konga introduce（konga 介绍）</h2><p>Kong is an API Gateway, which is distributed, high-performance, high-concurrency, scalable, and extensible. It provides load balancing, dynamic configuration, service registration, service discovery, service fuse, health detection, fault recovery, authorization authentication, rate limiting, caching processing, index monitoring, logging, and other functions. </p>\n<p>Konga is an unofficial application that supports the latest version of Kong Admin API with a brief UI. </p>\n<p>In a nutshell, konga is a graphical system for managing Kong</p>\n<h2 id=\"Vulnerability-description（漏洞描述）\"><a href=\"#Vulnerability-description（漏洞描述）\" class=\"headerlink\" title=\"Vulnerability description（漏洞描述）\"></a>Vulnerability description（漏洞描述）</h2><p>As mentioned in the introduction, konga call api is using jwt to do authentication, but konga jwt default key in the source code is not modified, we can easily download from GitHub to konga source code audit its jwt default key, and then realize identity forgery</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>konga Project address</p>\n<p><a href=\"https://github.com/pantsel/konga\">https://github.com/pantsel/konga</a></p></blockquote>\n<p>Upon further audit of the code, you can see that it is returned by encrypting the jwt with user.id</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805221127411.png\" alt=\"image-20230805221127411\"></p>\n<p>Then trace the key when jwt encryption, you can see that the default key is: <code>oursecret</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805220814366.png\" alt=\"image-20230805220814366\"></p>\n<p>After analyzing the code, we tried to exploit the vulnerability</p>\n<h2 id=\"Loophole-principle（漏洞原理）\"><a href=\"#Loophole-principle（漏洞原理）\" class=\"headerlink\" title=\"Loophole principle（漏洞原理）\"></a>Loophole principle（漏洞原理）</h2><p>Start konga with docker</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker pull pantsel&#x2F;konga\ndocker run -p 1337:1337 --name konga  pantsel&#x2F;konga</code></pre>\n\n<p>To see the konga sign-up page, go to <a href=\"http://127.0.0.1:1337/\">http://127.0.0.1:1337</a></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805222702079.png\" alt=\"image-20230805222702079\"></p>\n<p>Log in as an admin user</p>\n<p>Log in and capture packets</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805230403346.png\" alt=\"image-20230805230403346\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805230347713.png\" alt=\"image-20230805230347713\"></p>\n<p>Note the token value of the login packet</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805230454489.png\" alt=\"image-20230805230454489\"></p>\n<p>We went to jwt’s website to try to mimic the token</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://jwt.io/#debugger-io\">https://jwt.io/#debugger-io</a></p></blockquote>\n<p>Generate a jwt-token with a uid in one place and a Konga default key in the other</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805232546059.png\" alt=\"image-20230805232546059\"></p>\n<p>The result of observing the coding is consistent with that of capturing the packet</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805232621870.png\" alt=\"image-20230805232621870\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805232628279.png\" alt=\"image-20230805232628279\"></p>\n<p>With the successful construction, this jwt allows us to bypass login restrictions and access API interfaces that only administrators can access</p>\n<p>payload：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">eyJhbGciOiJIUzI1NiJ9.MQ.Lu-KcR4aCeuT9hi1K474zV3s4VaopLDCcf4nZvH6DQo</code></pre>\n\n<h2 id=\"Case-reproduction（案例复现）\"><a href=\"#Case-reproduction（案例复现）\" class=\"headerlink\" title=\"Case reproduction（案例复现）\"></a>Case reproduction（案例复现）</h2><p>As shown, this is a test site</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805233114905.png\" alt=\"image-20230805233114905\"></p>\n<p>We had direct access to some of the administrator rights API interfaces and found that authentication was required</p>\n<p>such as</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;ip:port&#x2F;api&#x2F;kongnode</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805233209882.png\" alt=\"image-20230805233209882\"></p>\n<p>Request this page again, grab the packet</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805233339772.png\" alt=\"image-20230805233339772\"></p>\n<p>Then we add the token generated by the jwt website to the request header</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">authorization:Bearer eyJhbGciOiJIUzI1NiJ9.MQ.Lu-KcR4aCeuT9hi1K474zV3s4VaopLDCcf4nZvH6DQo</code></pre>\n\n<p>Once again, you can see that unauthorized access to data within the interface with administrator permission was successful</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230805233630311.png\" alt=\"image-20230805233630311\"></p>\n<p>At this point, the repetition is complete</p>\n<h2 id=\"The-affected-version（受影响的版本）\"><a href=\"#The-affected-version（受影响的版本）\" class=\"headerlink\" title=\"The affected version（受影响的版本）\"></a>The affected version（受影响的版本）</h2><ul>\n<li>konga  v0.14.9</li>\n</ul>\n<p>In general, konga is widely deployed on the Internet, and malicious attackers can use this vulnerability to gain unauthorized administrator access to sensitive information, causing a serious information leakage crisis</p>\n","feature":true,"text":"Konga Unauthorized access(CVE-2023-39846)konga introduce（konga 介绍）Kong is an API Gateway, which is distributed, high-performance, high-concu...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/categories/漏洞.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":2,"path":"api/tags/漏洞复现.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Konga-Unauthorized-access-CVE-2023-39846\"><span class=\"toc-text\">Konga Unauthorized access(CVE-2023-39846)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#konga-introduce%EF%BC%88konga-%E4%BB%8B%E7%BB%8D%EF%BC%89\"><span class=\"toc-text\">konga introduce（konga 介绍）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Vulnerability-description%EF%BC%88%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0%EF%BC%89\"><span class=\"toc-text\">Vulnerability description（漏洞描述）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Loophole-principle%EF%BC%88%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%EF%BC%89\"><span class=\"toc-text\">Loophole principle（漏洞原理）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Case-reproduction%EF%BC%88%E6%A1%88%E4%BE%8B%E5%A4%8D%E7%8E%B0%EF%BC%89\"><span class=\"toc-text\">Case reproduction（案例复现）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#The-affected-version%EF%BC%88%E5%8F%97%E5%BD%B1%E5%93%8D%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%89\"><span class=\"toc-text\">The affected version（受影响的版本）</span></a></li></ol></li></ol>","author":{"name":"caTt0m","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现","uid":"9bf8f015d45821d6b638f52155e8a097","slug":"Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现","date":"2023-09-26T01:07:32.388Z","updated":"2023-10-09T01:07:11.393Z","comments":true,"path":"api/articles/Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-l8weeq.jpg","text":"漏洞介绍产品介绍Adobe ColdFusion是美国Adobe公司的一款动态Web服务器产品，其运行的CFML（ColdFusion Markup Language）是针对Web应用的一种程序设计语言。 Adobe ColdFusion 是一个全面且功能强大的服务器端应用程序开...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/categories/漏洞.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":2,"path":"api/tags/漏洞复现.json"}],"author":{"name":"caTt0m","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"hvv猴子的基本修养","uid":"d15f0aacce8c38a896ba8374b8a2f215","slug":"hvv蓝队常用命令（Linux）","date":"2023-04-23T10:40:02.636Z","updated":"2023-05-25T08:27:29.546Z","comments":true,"path":"api/articles/hvv蓝队常用命令（Linux）.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-x66olo.jpg","text":"前言记录一下最近学到的在护网中蓝队必备的，以及一些能提高工作效率的Linux命令 必备篇mkdir这个自然不必多说了 mkdir命令用于创建目录 参数 -p 创建多级目录,若目录不存在则新建一个 mkdir -p hvv&#x2F;blue lsls用于限制指定目录下的内容 参数...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":13,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"蓝队","slug":"蓝队","count":2,"path":"api/tags/蓝队.json"}],"author":{"name":"caTt0m","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true}}