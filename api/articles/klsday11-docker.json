{"title":"docker容器-klsday11","uid":"6a5c3f7124a5a7810eca7a15febbc057","slug":"klsday11-docker","date":"2023-05-30T01:05:21.661Z","updated":"2023-06-01T11:13:52.123Z","comments":true,"path":"api/articles/klsday11-docker.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-jx32vy.jpg","content":"<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530111435798.png\" alt=\"image-20230530111435798\"></p>\n<h2 id=\"docker容器技术\"><a href=\"#docker容器技术\" class=\"headerlink\" title=\"docker容器技术\"></a>docker容器技术</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530111516997.png\" alt=\"image-20230530111516997\"></p>\n<h3 id=\"docker容器概述\"><a href=\"#docker容器概述\" class=\"headerlink\" title=\"docker容器概述\"></a>docker容器概述</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530111601184.png\" alt=\"image-20230530111601184\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530111840386.png\" alt=\"image-20230530111840386\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112053090.png\" alt=\"image-20230530112053090\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112139099.png\" alt=\"image-20230530112139099\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112234857.png\" alt=\"image-20230530112234857\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112348123.png\" alt=\"image-20230530112348123\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112356609.png\" alt=\"image-20230530112356609\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112403872.png\" alt=\"image-20230530112403872\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112416468.png\" alt=\"image-20230530112416468\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112423509.png\" alt=\"image-20230530112423509\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530112450050.png\" alt=\"image-20230530112450050\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530094938580.png\" alt=\"image-20230530094938580\"></p>\n<p><code>yum install -y epel-release</code></p>\n<h3 id=\"docker容器的应用\"><a href=\"#docker容器的应用\" class=\"headerlink\" title=\"docker容器的应用\"></a>docker容器的应用</h3><p><a href=\"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors\">阿里云镜像加速器</a></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530102357701.png\" alt=\"image-20230530102357701\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530103820623.png\" alt=\"image-20230530103820623\"></p>\n<p>查看centos镜像的详细资料：<code>docker search centos --no-trunc</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530103941228.png\" alt=\"image-20230530103941228\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530103946458.png\" alt=\"image-20230530103946458\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530104037803.png\" alt=\"image-20230530104037803\"></p>\n<p><code>docker run -itd --name test1 -p 801:80 nginx</code></p>\n<ul>\n<li><code>-i</code>：以交互模式运行容器。这个标志表示打开 STDIN，并保持容器的标准输入流 (stdin) 打开。</li>\n<li><code>-t</code>：为容器分配一个伪终端（pseudo-tty）。这个标志表示该容器将显示一个类似于交互式 shell 的终端。</li>\n<li><code>-d</code>：在后台模式下运行容器。这个标志表示使容器在后台运行，不会阻塞当前终端。</li>\n<li><code>-p 801:80</code>：将主机的端口 801 映射到容器内部的端口 80。其中，左侧的 801 表示主机（宿主机）上的端口号，右侧的 80 表示容器内部端口号。在这种情况下，当用户访问主机 IP 地址上的 801 端口时，Docker 会将请求转发到容器内部的 80 端口进行处理。</li>\n</ul>\n<p><code>docker cp /root/index.html test1:/usr/share/nginx/html/index.html</code></p>\n<p>这个命令的含义是将宿主机 <code>/root</code> 目录下的 <code>index.html</code> 文件复制到名为 <code>test1</code> 的容器中，并保存到容器内部的 <code>/usr/share/nginx/html/</code> 目录下的同名文件 <code>index.html</code> 中。</p>\n<p><code>docker run -itd --name test2 -p 802:80 -v /root/web:/usr/share/nginx/html/ nginx</code></p>\n<p>这个命令启动了一个名为 <code>test2</code> 的后台 Nginx 容器，并将宿主机中的 <code>/root/web</code> 目录挂载为容器内部的 <code>/usr/share/nginx/html/</code> 目录，同时将宿主机的 802 端口映射到容器内部的 80 端口。</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530110545889.png\" alt=\"image-20230530110545889\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530132920232.png\" alt=\"image-20230530132920232\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530140732258.png\" alt=\"image-20230530140732258\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530140954292.png\" alt=\"image-20230530140954292\"></p>\n<p>在官网拉起一个centos-yum的镜像，在本地挂载光盘用它下载了软件后，制作成新的镜像</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@kls2 ~]# docker search centos-yum\n[root@kls2 ~]# docker pull docker.io&#x2F;noxiii&#x2F;centos-yum\n[root@kls2 ~]# docker run -itd --name test1 docker.io&#x2F;noxiii&#x2F;centos-yum &#x2F;bin&#x2F;bash\n[root@kls2 ~]# docker exec -it test1 &#x2F;bin&#x2F;bash\nbash-4.2# \n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nbash-4.2# cat &#x2F;etc&#x2F;hosts\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n172.17.0.2\t871508092c74\n（这一步是查看IP地址，或者可以用 docker inspect test1查看test1的IP地址）\n\nbash-4.2# cd &#x2F;etc&#x2F;yum.repos.d&#x2F;\nbash-4.2# ls\nCentOS-Base.repo  CentOS-Debuginfo.repo  CentOS-Sources.repo  CentOS-fasttrack.repo\nCentOS-CR.repo\t  CentOS-Media.repo\t CentOS-Vault.repo\nbash-4.2# mkdir repo\nbash-4.2# mv *.repo repo\nbash-4.2# ls\nrepo\nbash-4.2# vi server.repo\nbash: vi: command not found\nbash-4.2# cat &lt;&lt; EOF &gt; server.repo\n&gt; [server]\n&gt; name&#x3D;server\n&gt; gpgcheck&#x3D;0\n&gt; baseurl&#x3D;http:&#x2F;&#x2F;172.17.0.1\n&gt; EOF\nbash-4.2# ls\nrepo  server.repo\nbash-4.2# cat server.repo \n[server]\nname&#x3D;server\ngpgcheck&#x3D;0\nbaseurl&#x3D;http:&#x2F;&#x2F;172.17.0.1  #宿主机的IP地址\nbash-4.2# \nbash-4.2# cat &#x2F;etc&#x2F;resolv.conf \n# Generated by NetworkManager\nsearch localdomain\nnameserver 192.168.235.2\nbash-4.2# uname -r\n3.10.0-1160.el7.x86_64\nbash-4.2# yum -y install vim samba*\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;3&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\nbash-4.2# exit\nexit\n[root@kls2 ~]# docker commit test1 centos-yum:samba\nsha256:b80632fc3b6b2ffc54f8b3feb6dac3191232db273afda049f79b5627ef0ce251\n[root@kls2 ~]# docker images\nREPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE\ncentos-yum                    samba               b80632fc3b6b        16 seconds ago      353 MB\ndocker.io&#x2F;noxiii&#x2F;centos-yum   latest              06201c2c169b        4 years ago         101 MB\n[root@kls2 ~]# docker save -o &#x2F;root&#x2F;centosyum-samba.tar centos-yum:samba\n[root@kls2 ~]# ls ~\nanaconda-ks.cfg  centosyum-samba.tar  nmap.sh  samba.sh\n[root@kls2 ~]# docker diff test1\nA &#x2F;var&#x2F;lib&#x2F;yum&#x2F;yumdb&#x2F;w&#x2F;01530fd2bd615864e31bb31c1fbd0fd590f3c702-which-2.20-7.el7-x86_64&#x2F;var_uuid\nC &#x2F;var&#x2F;lib&#x2F;yum&#x2F;yumdb&#x2F;x\nD &#x2F;var&#x2F;lib&#x2F;yum&#x2F;yumdb&#x2F;x&#x2F;f4b0152eb57abf88e3c3f8d52cefb7be144949b6-xz-5.2.2-1.el7-x86_64\nA &#x2F;var&#x2F;lib&#x2F;yum&#x2F;yumdb&#x2F;x&#x2F;f4b0152eb57abf88e3c3f8d52cefb7be144949b6-xz-5.2.2-1.el7-x86_64&#x2F;checksum_data\n##### A:添加的 ##### D：删除的 ##### C:改变的\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;4&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;\n[root@kls2 ~]# docker rmi centos-yum:samba\nUntagged: centos-yum:samba\nDeleted: sha256:b80632fc3b6b2ffc54f8b3feb6dac3191232db273afda049f79b5627ef0ce251\nDeleted: sha256:96b7fe8e969ace0e9179b4965929f161f0fa1fba2e5a62586a1cc5db50b658e1\n[root@kls2 ~]# docker load -i &#x2F;root&#x2F;centosyum-samba.tar \n330fac4c4472: Loading layer [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 260.3 MB&#x2F;260.3 MB\nLoaded image: centos-yum:samba\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;5&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</code></pre>\n\n<p>另起一个终端</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">[root@kls2 ~]# yum -y install httpd\n[root@kls2 ~]# mount &#x2F;dev&#x2F;cdrom &#x2F;var&#x2F;www&#x2F;html&#x2F;\n[root@kls2 ~]# systemctl start httpd\n&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</code></pre>\n\n<h3 id=\"docker-file\"><a href=\"#docker-file\" class=\"headerlink\" title=\"docker file\"></a>docker file</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530141038921.png\" alt=\"image-20230530141038921\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530141113267.png\" alt=\"image-20230530141113267\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530142659708.png\" alt=\"image-20230530142659708\"></p>\n<h3 id=\"docker-swarm\"><a href=\"#docker-swarm\" class=\"headerlink\" title=\"docker swarm\"></a>docker swarm</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530150416880.png\" alt=\"image-20230530150416880\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530150520147.png\" alt=\"image-20230530150520147\"></p>\n<h4 id=\"集群搭建\"><a href=\"#集群搭建\" class=\"headerlink\" title=\"集群搭建\"></a>集群搭建</h4><p>准备三台虚拟机，最好都有4g内存，关防火墙，关selinux，然后在三台虚拟机上都装docker</p>\n<p>将这四个包放到管理主机上</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530153242677.png\" alt=\"image-20230530153242677\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">kls2&#x3D;192.168.235.134&#x2F;24       manage&amp;work\ntest1&#x3D;192.168.235.135&#x2F;24\ntest2&#x3D;192.168.235.136&#x2F;24</code></pre>\n\n<p><strong>管理机</strong></p>\n<p><code>vim /etc/hosts</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530161355518.png\" alt=\"image-20230530161355518\"></p>\n<p><code> scp /etc/hosts root@192.168.235.135:/etc/hosts</code></p>\n<p><code>scp /etc/hosts root@192.168.235.136:/etc/hosts</code></p>\n<p><code>ping test1</code></p>\n<p><code>ping test2</code></p>\n<p><code>ssh-keygen</code> 一路回车</p>\n<p><code>ssh-copy-id root@test1</code></p>\n<p><code>ssh-copy-id root@test2</code></p>\n<p><code>ssh-copy-id root@kls2</code></p>\n<p><code>docker swarm init --advertise-addr 192.168.235.134</code></p>\n<p>复制这段，粘贴到test1，test2</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker swarm join \\\n    --token SWMTKN-1-1dkl9haf2bd4rj83zp2opast068pqlzvwiaxwmbmlq0oqwa400-7a8oryovohaz9asda11vz0bou \\\n    192.168.235.134:2377</code></pre>\n\n<p><code>docker node ls</code> 查看</p>\n<p><code>vim /etc/sysctl.conf </code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530160745019.png\" alt=\"image-20230530160745019\"></p>\n<p><code>sysctl -p</code></p>\n<p><code>scp /etc/sysctl.conf test1:/etc/</code></p>\n<p><code>sysctl -p</code></p>\n<p><code>scp /etc/sysctl.conf test2:/etc/</code></p>\n<p><code>sysctl -p</code></p>\n<p>管理机找到包</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530161252431.png\" alt=\"image-20230530161252431\"></p>\n<p><code>docker load -i registry2.tar</code></p>\n<p><code>mkdir -p /opt/data/registry</code></p>\n<p><code>docker run -itd -p 5000:5000 --restart=always -v /opt/data/registry/:/var/lib/registry --name registry docker.io/registry</code></p>\n<p><code>curl 192.168.235.134:5000/v2/_catalog</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530162535667.png\" alt=\"image-20230530162535667\"></p>\n<p><code>vim /usr/lib/systemd/system/docker.service</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530162928561.png\" alt=\"image-20230530162928561\"></p>\n<p><code>systemctl daemon-reload</code></p>\n<p><code>systemctl restart docker</code></p>\n<p><code>scp /usr/lib/systemd/system/docker.service test1:/usr/lib/systemd/system/</code></p>\n<p><code>scp /usr/lib/systemd/system/docker.service test2:/usr/lib/systemd/system/</code></p>\n<p>然后切换到那两台主机，<code>systemctl daemon-reload</code>，<code>systemctl restart docker</code></p>\n<p>回到管理机</p>\n<p><code>docker load -i nginx.tar</code></p>\n<p><code>docker tag nginx 192.168.235.134:5000/nginx</code></p>\n<p><code>docker push 192.168.235.134:5000/nginx</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530163932008.png\" alt=\"image-20230530163932008\"></p>\n<p><code>!curl</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530164023368.png\" alt=\"image-20230530164023368\"></p>\n<p>查看网络：<code>docker network ls</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530164408960.png\" alt=\"image-20230530164408960\"></p>\n<p>创建一个自己的网络：<code>network create --driver overlay abyssaler</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530164435093.png\" alt=\"image-20230530164435093\"></p>\n<p><code>docker load -i visualizer.tar</code></p>\n<p><code>docker tag docker.io/dockersamples/visualizer 192.168.235.134:5000/visualizer</code></p>\n<p><code>docker push 192.168.235.134:5000/visualizer</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530164653492.png\" alt=\"image-20230530164653492\"></p>\n<p><code>docker run -itd -p 8888:8080 -e HOST=192.168.235.134 -e PORT=8080 -v /var/run/docker.sock:/var/run/docker.sock --name visualizer 192.168.235.134:5000/visualizer</code></p>\n<p>用浏览器访问<code>192.168.235.134:8888</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530165203049.png\" alt=\"image-20230530165203049\"></p>\n<p><code>docker service create --replicas 6 --network abyssaler --name nginxweb -p 80:80 192.168.235.134:5000/nginx</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170102711.png\" alt=\"image-20230530170102711\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170121704.png\" alt=\"image-20230530170121704\"></p>\n<p><code>docker service ps nginxweb</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170238857.png\" alt=\"image-20230530170238857\"></p>\n<p>暂停一个虚拟机看看变化</p>\n<p><code>[root@test2 ~]# systemctl stop docker</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170449754.png\" alt=\"image-20230530170449754\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170459832.png\" alt=\"image-20230530170459832\"></p>\n<p>重启这个虚拟机</p>\n<p><code>systemctl start docker</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170544192.png\" alt=\"image-20230530170544192\"></p>\n<p>回到管理机</p>\n<p><code>docker service scale nginxweb=12</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170730202.png\" alt=\"image-20230530170730202\"></p>\n<p><code>docker service rm nginxweb</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230530170821039.png\" alt=\"image-20230530170821039\"></p>\n","feature":true,"text":" docker容器技术 docker容器概述 yum install -y epel-release docker容器的应用阿里云镜像加速器 查看centos镜像的详细资料：docker search centos --no-trunc docker run -itd --nam...","link":"","photos":[],"count_time":{"symbolsCount":"9k","symbolsTime":"8 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":25,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":12,"path":"api/tags/kls.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#docker%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF\"><span class=\"toc-text\">docker容器技术</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#docker%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">docker容器概述</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">docker容器的应用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#docker-file\"><span class=\"toc-text\">docker file</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#docker-swarm\"><span class=\"toc-text\">docker swarm</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">集群搭建</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"系统加固-klsday12","uid":"6eebacce59e6873455fbd427aa546b9b","slug":"klsday12-安全加固","date":"2023-05-30T14:07:21.312Z","updated":"2023-06-01T10:35:38.155Z","comments":true,"path":"api/articles/klsday12-安全加固.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-96vwgx.jpg","text":" 理论讲解 Linux系统加固 账号管理与认证授权 sudo 新建test用户 useradd test passwd test su test 编辑sudoers文件 如果不想输入sudo密码可以修改成 再次尝试sudo新建用户 检查高权限文件 find / -type f \\...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":25,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":12,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Linux-iptables防火墙-klsday10","uid":"a83094df2fe1f1931833ffcbbd33f63b","slug":"klsday10-Linux","date":"2023-05-29T00:54:56.229Z","updated":"2023-05-30T14:19:50.864Z","comments":true,"path":"api/articles/klsday10-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-exzzjo.jpg","text":" iptables基础规则 Linux防火墙基础包过滤防火墙概述 iptables其实不是真正的防火墙，更像一个客户端代理，通过客户端代理，将用户需要的安全设定或者说规则添加到对应的安全框架当中，这个安全框架才是真正的防火墙，也就是netfilter netfilter是基于包过...","link":"","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":25,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":12,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}