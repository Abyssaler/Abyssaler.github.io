{"title":"Linux网站服务-klsday7","uid":"3200a6e29852cc67d7326c337a5be9d2","slug":"klsday7-Linux","date":"2023-05-23T01:01:22.776Z","updated":"2023-05-26T07:37:20.203Z","comments":true,"path":"api/articles/klsday7-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-8x3qk2.jpg","content":"<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523092210874.png\" alt=\"image-20230523092210874\"></p>\n<h2 id=\"搭建Apache服务器\"><a href=\"#搭建Apache服务器\" class=\"headerlink\" title=\"搭建Apache服务器\"></a>搭建Apache服务器</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523092253195.png\" alt=\"image-20230523092253195\"></p>\n<h3 id=\"Apache简介\"><a href=\"#Apache简介\" class=\"headerlink\" title=\"Apache简介\"></a>Apache简介</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523092744196.png\" alt=\"image-20230523092744196\"></p>\n<h3 id=\"编译安装httpd服务器\"><a href=\"#编译安装httpd服务器\" class=\"headerlink\" title=\"编译安装httpd服务器\"></a>编译安装httpd服务器</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523092908904.png\" alt=\"image-20230523092908904\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523093019042.png\" alt=\"image-20230523093019042\"></p>\n<p>所有路径都是基于<code>./configure --prefix=/usr</code>指定的</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523093435139.png\" alt=\"image-20230523093435139\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523093752484.png\" alt=\"image-20230523093752484\"></p>\n<p><strong>注意，源码安装之前一定要卸载已经安装好的apache</strong></p>\n<p>解压</p>\n<p><code>tar fx httpd-2.4.52.tar.gz</code></p>\n<p><code>cd /httpd-2.4.52</code></p>\n<p>安装apache的两组依赖包：<code>yum -y install apr* pcre*</code></p>\n<p>获取帮助：<code>./configure --help</code></p>\n<p>配置：<code>./configure --prefix=/usr/local/httpd --enable-so --enable-rewrite --enable-charset-lite --enable-cgi</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;httpd：指定了 Apache HTTPD Web 服务器的安装目录为 &#x2F;usr&#x2F;local&#x2F;httpd。这意味着已编译的二进制文件、库文件和配置文件将安装到该目录下。这是自定义安装路径的常见做法。\n--enable-so：启用共享对象支持，这使得 Apache HTTPD Web 服务器可以动态地加载模块，而不必在编译时静态链接它们。这使得服务器更加灵活和可扩展。\n--enable-rewrite：启用 URL 重写引擎模块 (mod_rewrite)，这是 Apache HTTPD Web 服务器非常有用的功能之一，它允许创建复杂的 URL 规则和转发机制，以便更好地管理和优化 Web 站点的 URL 结构。\n--enable-charset-lite：启用字符编码支持，这是 Apache HTTPD Web 服务器提供国际化支持的重要功能之一。字符编码支持可以确保 Web 站点在不同语言环境下的正确呈现和传输。\n--enable-cgi：启用公共网关接口 (CGI) 支持，这使得 Apache HTTPD Web 服务器可以执行动态网页脚本。CGI 是一种广泛应用于 Web 开发中的技术，它可以让 Web 服务器调用脚本解释器来处理 Web 请求，并将结果返回给用户。</code></pre>\n\n<p>编译：<code>make -j2</code></p>\n<p>安装：<code>make install</code></p>\n<p><code>cd /usr/local/httpd/</code></p>\n<p><code>./bin/apachectl start</code></p>\n<p>创建软链接：<code>ln -s /usr/local/httpd/bin/* /usr/bin/</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523161136357.png\" alt=\"image-20230523161136357\"></p>\n<p>解决这个报错的办法</p>\n<p><code>vim /usr/local/httpd/conf/httpd.conf</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523161342366.png\" alt=\"image-20230523161342366\"></p>\n<p>修改如图所示，就没有报错了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523161517474.png\" alt=\"image-20230523161517474\"></p>\n<h3 id=\"apache配置\"><a href=\"#apache配置\" class=\"headerlink\" title=\"apache配置\"></a>apache配置</h3><h4 id=\"全局设置\"><a href=\"#全局设置\" class=\"headerlink\" title=\"全局设置\"></a>全局设置</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523101004077.png\" alt=\"image-20230523101004077\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">选项解析：\nlisten：监听那个端口   \nuser，group：以什么身份启动apache\nserveradmin：管理员邮箱\nservername：服务器的名称\ndocumentroot：web默认页面存放的位置\ndirectoryindex：定义网站默认打开哪个文件\nerrorlog：错误日志位置\nloglevel：错误日志级别，级别越高，记录信息越少\ncustomlog：访问日志位置\npidfile：pid文件存放位置，即锁定文件，保证一个程序同一时间只能运行一个\ncharset default：默认字符集\ninclude：包含的额外的配置文件位置</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523102112791.png\" alt=\"image-20230523102112791\"></p>\n<h4 id=\"授权访问设置\"><a href=\"#授权访问设置\" class=\"headerlink\" title=\"授权访问设置\"></a>授权访问设置</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523161841130.png\" alt=\"image-20230523161841130\"></p>\n<p>上面这个是2.2版本的写法</p>\n<p>下面这个是2.4版本的写法，用这个（Require all denied 全拒绝）</p>\n<h2 id=\"apache日志分析工具AWStats\"><a href=\"#apache日志分析工具AWStats\" class=\"headerlink\" title=\"apache日志分析工具AWStats\"></a>apache日志分析工具AWStats</h2><p>AWStats 是一款开源的网站统计分析工具，它可以通过分析 Web 服务器的访问日志来生成详细的报告，展示网站的访问情况、流量情况、访客来源、页面浏览量、搜索引擎关键字等等信息。AWStats 支持多种 Web 服务器软件，包括 Apache、Nginx、IIS 等，它是使用 Perl 编写的，可以在 Linux&#x2F;Unix、Windows 和 Mac OS X 等操作系统上使用。</p>\n<h3 id=\"awstats编译安装\"><a href=\"#awstats编译安装\" class=\"headerlink\" title=\"awstats编译安装\"></a>awstats编译安装</h3><p>解压：<code>tar xf AWStats-AWSTATS_7_8.tar.gz -C /usr/local/</code></p>\n<p>改个好记得名字：<code>mv AWStats-AWSTATS_7_8 awstats</code></p>\n<h3 id=\"配置awstats\"><a href=\"#配置awstats\" class=\"headerlink\" title=\"配置awstats\"></a>配置awstats</h3><p><code>cd /usr/local/awstats/tools/</code></p>\n<p> <code>./awstats_configure.pl </code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523132629287.png\" alt=\"image-20230523132629287\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523203540559.png\" alt=\"image-20230523203540559\"></p>\n<p>查看生成的文件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523203511340.png\" alt=\"image-20230523203511340\"></p>\n<p>修改刚才生成的配置文件</p>\n<p><code>vim /etc/awstats/awstats.www.chaitin.com.conf</code></p>\n<p><code>vim /etc/awstats/awstats.www.alibaba.com.conf</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523134427072.png\" alt=\"image-20230523134427072\"></p>\n<p>创建存放awstats存放日志的文件夹：<code>mkdir -p /var/lib/awstats</code></p>\n<p>在awstats目录下更新一下<code>./awstats_updateall.pl now</code></p>\n<p>报错</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523204331763.png\" alt=\"image-20230523204331763\"></p>\n<p><code>vim /usr/local/awstats/wwwroot/cgi-bin/lib/mime.pm</code></p>\n<p>59行：加个逗号</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523134802959.png\" alt=\"image-20230523134802959\"></p>\n<p>在awstats目录下更新一下<code>./awstats_updateall.pl now</code></p>\n<p>访问下</p>\n<p><code>http://localhost/awstats/awstats.pl?config=www.chaiting.com</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523205105899.png\" alt=\"image-20230523205105899\"></p>\n<p>报错，权限不足</p>\n<p><code>vim /usr/local/httpd/conf/httpd.conf</code></p>\n<p>最后一行修改为</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523140501118.png\" alt=\"image-20230523140501118\"></p>\n<p>重启apache服务</p>\n<p><code>/usr/local/httpd/bin/apachectl restart</code></p>\n<p>重新访问下<code>http://localhost/awstats/awstats.pl?config=www.chaiting.com</code>，成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523205827297.png\" alt=\"image-20230523205827297\"></p>\n<p>但是发现网页语言没有被执行</p>\n<p>打开cgi功能</p>\n<p><code>vim /usr/local/httpd/conf/httpd.conf</code></p>\n<p>:&#x2F;cgi</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523210035620.png\" alt=\"image-20230523210035620\"></p>\n<p>重启apache服务</p>\n<p><code>/usr/local/httpd/bin/apachectl restart</code>，一次不行多重启几次</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523210440686.png\" alt=\"image-20230523210440686\"></p>\n<h2 id=\"配置访问限制\"><a href=\"#配置访问限制\" class=\"headerlink\" title=\"配置访问限制\"></a>配置访问限制</h2><p>默认情况这个页面所有人都能访问</p>\n<h3 id=\"白名单\"><a href=\"#白名单\" class=\"headerlink\" title=\"白名单\"></a>白名单</h3><p>在<code>/usr/local/httpd/conf/httpd.conf</code>中修改成下图所示，即白名单，只允许192.168.3.10访问awstats页面</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523211314363.png\" alt=\"image-20230523211314363\"></p>\n<h3 id=\"黑名单\"><a href=\"#黑名单\" class=\"headerlink\" title=\"黑名单\"></a>黑名单</h3><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523211723203.png\" alt=\"image-20230523211723203\"></p>\n<h3 id=\"用户认证访问\"><a href=\"#用户认证访问\" class=\"headerlink\" title=\"用户认证访问\"></a>用户认证访问</h3><p>创建用户：</p>\n<p><code>/usr/local/httpd/bin/htpasswd -c /usr/local/httpd/.chaitinpwd chaitin</code></p>\n<p>想要继续创建就不要<code>-c</code>不然会把之前的覆盖掉</p>\n<p><code>/usr/local/httpd/bin/htpasswd /usr/local/httpd/.chaitinpwd chaitin2</code></p>\n<p>然后修改主配置文件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523212450307.png\" alt=\"image-20230523212450307\"></p>\n<p>这段配置代码放到哪个文件就会在哪个文件生效</p>\n<p>如复制到虚拟主机中<code>vim /usr/local/httpd/conf/extra/httpd-vhosts.conf</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523213141556.png\" alt=\"image-20230523213141556\"></p>\n<h2 id=\"构建Apache虚拟主机\"><a href=\"#构建Apache虚拟主机\" class=\"headerlink\" title=\"构建Apache虚拟主机\"></a>构建Apache虚拟主机</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523162334409.png\" alt=\"image-20230523162334409\"></p>\n<p>创建测试站点根目录</p>\n<p><code>mkdir -p /var/www/html</code></p>\n<p><code>mkdir /var/www/html/chaitin /var/www/html/alibaba</code></p>\n<p>创建测试网页</p>\n<p><code>vim /var/www/html/chaitin/index.html</code></p>\n<p><code>vim /var/www/html/alibaba/index.html</code></p>\n<p>修改虚拟主机文件</p>\n<p><code>vim /usr/local/httpd/conf/extra/httpd-vhosts.conf</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523165600121.png\" alt=\"image-20230523165600121\"></p>\n<p>修改主配置文件，开启vhosts的模块</p>\n<p><code>vim /usr/local/httpd/conf/httpd.conf </code></p>\n<p>搜索vhost：<code>/vhost</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523165924895.png\" alt=\"image-20230523165924895\"></p>\n<p>重启服务</p>\n<p><code>/usr/local/httpd/bin/apachectl restart</code></p>\n<p>修改客户机host文件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523190730895.png\" alt=\"image-20230523190730895\"></p>\n<p>报错了,因为没有授权</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523190834458.png\" alt=\"image-20230523190834458\"></p>\n<p>修改虚拟主机授权</p>\n<p><code>vim /usr/local/httpd/conf/extra/httpd-vhosts.conf</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523191252356.png\" alt=\"image-20230523191252356\"></p>\n<p>重启服务再试</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523191359842.png\" alt=\"image-20230523191359842\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523191411773.png\" alt=\"image-20230523191411773\"></p>\n<p>配置用户认证功能</p>\n<p>使用htpasswd 创建一个用户 chaitin并配置密码</p>\n<p><code>cd /usr/local/httpd/conf/</code></p>\n<p><code>htpasswd -c .chaitinpwd chaitin</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523193203375.png\" alt=\"image-20230523193203375\"></p>\n<p>添加用户授权配置</p>\n<p>编辑httpd.conf，在文件末尾添加如下内容</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523194432500.png\" alt=\"image-20230523194432500\"></p>\n<p>重启服务</p>\n<p><code>/usr/local/httpd/bin/apachectl restart</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523194446220.png\" alt=\"image-20230523194446220\"></p>\n<h2 id=\"搭建Nginx服务器\"><a href=\"#搭建Nginx服务器\" class=\"headerlink\" title=\"搭建Nginx服务器\"></a>搭建Nginx服务器</h2><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523224622279.png\" alt=\"image-20230523224622279\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523224841535.png\" alt=\"image-20230523224841535\"></p>\n<h3 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h3><p><code>yum -y install pcre-devel zlib-devel</code></p>\n<p>创建nginx用户：<code>useradd -M -s /sbin/nologin nginx</code></p>\n<p><code>tar xf nginx-1.6.0.tar.gz </code></p>\n<p><code>cd nginx-1.6.0</code></p>\n<p><code>./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_stub_status_module</code></p>\n<p><code>make -j2 &amp;&amp; make install</code></p>\n<p>创建软链接：<code>ln -s /usr/local/nginx /sbin/* /usr/bin</code></p>\n<p>启动nginx：<code>nginx</code>，报错</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523230216564.png\" alt=\"image-20230523230216564\"></p>\n<p>要修改著配置文件<code>vim /usr/local/nginx/conf/nginx.conf</code>，把第一行的#删了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523230308726.png\" alt=\"image-20230523230308726\"></p>\n<p>再运行<code>nginx</code>即可运行，这里是端口占用了，把apache停用了再启动<code>nginx</code>即可</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523230807889.png\" alt=\"image-20230523230807889\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230523231150188.png\" alt=\"image-20230523231150188\"></p>\n<p>查看80端口的端口占用：<code>lsof -i :80</code></p>\n<h2 id=\"使用squid搭建缓存服务器\"><a href=\"#使用squid搭建缓存服务器\" class=\"headerlink\" title=\"使用squid搭建缓存服务器\"></a>使用squid搭建缓存服务器</h2><p>Squid是一款免费的开放源代码的HTTP代理和缓存服务器软件，可以在常见的操作系统上运行，如Linux、Unix和Windows等。它通过使用缓存技术，提供更快的Web访问速度，减少带宽占用和响应时间，同时还可以过滤请求和响应以提高安全性。</p>\n<p>Squid默认的端口是3128。当你安装并启动Squid代理服务后，客户端在使用该代理时需要指定Squid服务器的地址和端口号，例如：192.168.1.100:3128，其中3128就是Squid默认的端口。</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524095432809.png\" alt=\"image-20230524095432809\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524095417392.png\" alt=\"image-20230524095417392\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524151618708.png\" alt=\"image-20230524151618708\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524151635112.png\" alt=\"image-20230524151635112\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524151757880.png\" alt=\"image-20230524151757880\"></p>\n<p>拓扑结构如图</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524161922555.png\" alt=\"image-20230524161922555\"></p>\n<h3 id=\"缓存服务器配置-squid\"><a href=\"#缓存服务器配置-squid\" class=\"headerlink\" title=\"缓存服务器配置(squid)\"></a>缓存服务器配置(squid)</h3><p>先修改下主机名：hostname squid</p>\n<p>添加一块网卡</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524153458961.png\" alt=\"image-20230524153458961\"></p>\n<p><code>ip a</code>确定有两个网卡</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524154153178.png\" alt=\"image-20230524154153178\"></p>\n<p>安装squid包：yum -y install squid</p>\n<p>分成两个网段：192.168.2.153，192.168.3.111</p>\n<p>cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;</p>\n<p>cp ifcfg-ens33 ifcfg-ens36</p>\n<p>修改第二块网卡：vim ifcfg-ens36</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">TYPE&#x3D;&quot;Ethernet&quot;\nPROXY_METHOD&#x3D;&quot;none&quot;\nBROWSER_ONLY&#x3D;&quot;no&quot;\nBOOTPROTO&#x3D;&quot;static&quot;\nDEFROUTE&#x3D;&quot;yes&quot;\nNAME&#x3D;&quot;ens36&quot;\nDEVICE&#x3D;&quot;ens36&quot;\nONBOOT&#x3D;&quot;yes&quot;\nIPADDR&#x3D;&quot;192.168.3.111&quot;\nNETMASK&#x3D;&quot;255.255.255.0&quot;</code></pre>\n\n<p>systemctl status NetworkManager</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524155644397.png\" alt=\"image-20230524155644397\"></p>\n<p>systemctl stop NetworkManager</p>\n<p>systemctl disable NetworkManager</p>\n<p>systemctl restart network</p>\n<p>ip a</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524155841073.png\" alt=\"image-20230524155841073\"></p>\n<p>vim &#x2F;etc&#x2F;squid&#x2F;squid.conf</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524162416943.png\" alt=\"image-20230524162416943\"></p>\n<p>systemctl restart squid.service</p>\n<p>如果代理不成功，关闭防火墙，selinux，重启squid服务</p>\n<h4 id=\"透明代理\"><a href=\"#透明代理\" class=\"headerlink\" title=\"透明代理\"></a>透明代理</h4><p>开启网卡转发功能：echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</p>\n<p>vim &#x2F;etc&#x2F;squid&#x2F;squid.conf</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524213329249.png\" alt=\"image-20230524213329249\"></p>\n<p>systemctl restart squid.service</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">添加防火墙规则：\niptables -t nat -I PREROUTING -i ens33 -s 192.168.2.0&#x2F;24 -p tcp --dport 80 -j REDIRECT --to-ports 3128\niptables -t nat -I PREROUTING -i ens33 -s 192.168.2.0&#x2F;24 -p tcp --dport 443 -j REDIRECT --to-ports 3128</code></pre>\n\n<p>客户机配置网关指向代理服务器</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524214945965.png\" alt=\"image-20230524214945965\"></p>\n<p>查看路由表</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524215159806.png\" alt=\"image-20230524215159806\"></p>\n<p>客户端浏览器不使用代理</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524215300239.png\" alt=\"image-20230524215300239\"></p>\n<p>再次访问server</p>\n<h4 id=\"ACL访问控制\"><a href=\"#ACL访问控制\" class=\"headerlink\" title=\"ACL访问控制\"></a>ACL访问控制</h4><p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524221101590.png\" alt=\"image-20230524221101590\"></p>\n<p><img src=\"C:\\Users\\Abyssaler\\AppData\\Roaming\\Typora\\typora-user-images\\image-20230524221110821.png\" alt=\"image-20230524221110821\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524221123114.png\" alt=\"image-20230524221123114\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524221133340.png\" alt=\"image-20230524221133340\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524222250734.png\" alt=\"image-20230524222250734\"></p>\n<h3 id=\"外网服务器配置-server\"><a href=\"#外网服务器配置-server\" class=\"headerlink\" title=\"外网服务器配置(server)\"></a>外网服务器配置(server)</h3><p>hostname server</p>\n<p>yum -y install httpd</p>\n<p>systemctl restart httpd</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524160331072.png\" alt=\"image-20230524160331072\"></p>\n<p>systemctl stop NetworkManager</p>\n<p>systemctl disable NetworkManager</p>\n<p>vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33 </p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">TBLBMCNYPE&#x3D;&quot;Ethernet&quot;\nPROXY_METHOD&#x3D;&quot;none&quot;\nBROWSER_ONLY&#x3D;&quot;no&quot;\nBOOTPROTO&#x3D;&quot;static&quot;\nDEFROUTE&#x3D;&quot;yes&quot;\nNAME&#x3D;&quot;ens33&quot;\nDEVICE&#x3D;&quot;ens33&quot;\nONBOOT&#x3D;&quot;yes&quot;\nIPADDR&#x3D;&quot;192.168.3.237&quot;\nNETMASK&#x3D;&quot;255.255.255.0&quot;</code></pre>\n\n<p>systemctl restart network </p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524161314893.png\" alt=\"image-20230524161314893\"></p>\n<p>用192.168.2.169的客户机访问192.168.3.237的网页</p>\n<p>查看访问日志：tailf &#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524164650995.png\" alt=\"image-20230524164650995\"></p>\n<p>可以看到访问通过了代理</p>\n<h3 id=\"内网客户机机配置-client\"><a href=\"#内网客户机机配置-client\" class=\"headerlink\" title=\"内网客户机机配置(client)\"></a>内网客户机机配置(client)</h3><p>ip如图</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524163144679.png\" alt=\"image-20230524163144679\"></p>\n<p>打开代理</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524163306968.png\" alt=\"image-20230524163306968\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524163633762.png\" alt=\"image-20230524163633762\"></p>\n<p>然后访问192.168.3.237</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230524164551885.png\" alt=\"image-20230524164551885\"></p>\n","text":" 搭建Apache服务器 Apache简介 编译安装httpd服务器 所有路径都是基于./configure --prefix=/usr指定的 注意，源码安装之前一定要卸载已经安装好的apache 解压 tar fx httpd-2.4.52.tar.gz cd /httpd-2...","link":"","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":24,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":11,"path":"api/tags/kls.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%90%AD%E5%BB%BAApache%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">搭建Apache服务器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Apache%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">Apache简介</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85httpd%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">编译安装httpd服务器</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#apache%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">apache配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">全局设置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">授权访问设置</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#apache%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7AWStats\"><span class=\"toc-text\">apache日志分析工具AWStats</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#awstats%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">awstats编译安装</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEawstats\"><span class=\"toc-text\">配置awstats</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6\"><span class=\"toc-text\">配置访问限制</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%99%BD%E5%90%8D%E5%8D%95\"><span class=\"toc-text\">白名单</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%BB%91%E5%90%8D%E5%8D%95\"><span class=\"toc-text\">黑名单</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E8%AE%BF%E9%97%AE\"><span class=\"toc-text\">用户认证访问</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BAApache%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA\"><span class=\"toc-text\">构建Apache虚拟主机</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%90%AD%E5%BB%BANginx%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">搭建Nginx服务器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85nginx\"><span class=\"toc-text\">安装nginx</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8squid%E6%90%AD%E5%BB%BA%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">使用squid搭建缓存服务器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-squid\"><span class=\"toc-text\">缓存服务器配置(squid)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86\"><span class=\"toc-text\">透明代理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#ACL%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6\"><span class=\"toc-text\">ACL访问控制</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%96%E7%BD%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-server\"><span class=\"toc-text\">外网服务器配置(server)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E5%AE%A2%E6%88%B7%E6%9C%BA%E6%9C%BA%E9%85%8D%E7%BD%AE-client\"><span class=\"toc-text\">内网客户机机配置(client)</span></a></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Linux-Shell脚本应用-klsday8","uid":"51f59f2591b85dbbff00c606d35a67d4","slug":"klsday8-Linux","date":"2023-05-24T01:32:40.926Z","updated":"2023-05-25T08:52:13.474Z","comments":true,"path":"api/articles/klsday8-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-xllp6l.jpg","text":" shell脚本应用（一）shell脚本简单介绍 bash 和 shell 是密切相关的概念。 shell 是指一种操作系统的命令行解释器，它充当用户与操作系统内核之间的接口。而 bash (Bourne-Again SHell) 则是一种 Unix&#x2F;Linux 操作系...","link":"","photos":[],"count_time":{"symbolsCount":"9.9k","symbolsTime":"9 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":24,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":11,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"Linux文件传输服务-klsday6","uid":"32ad3e8d6b6ba6d99339baf1198a4c1f","slug":"klsday6-Linux","date":"2023-05-22T01:01:23.423Z","updated":"2023-05-25T08:47:01.000Z","comments":true,"path":"api/articles/klsday6-Linux.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-7p382e_2.png","text":" Samba 文件共享服务 Samba服务基础Samba是一种开源软件，它的功能是在Linux&#x2F;UNIX操作系统上实现与Windows操作系统的互操作性。主要用途是实现文件和打印机共享。 使用Samba服务可以将Linux&#x2F;UNIX操作系统上的文件共享给Win...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":24,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"kls","slug":"kls","count":11,"path":"api/tags/kls.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}