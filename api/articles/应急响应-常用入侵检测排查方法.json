{"title":"应急响应-常用入侵检测排查方法","uid":"42e35c706e2c2e039d7485aefd496756","slug":"应急响应-常用入侵检测排查方法","date":"2023-04-18T03:04:02.775Z","updated":"2023-04-18T03:03:27.287Z","comments":true,"path":"api/articles/应急响应-常用入侵检测排查方法.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-p9o7o9.png","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>​\t之前学习过程中，重点都是放在了web渗透和攻击这一块，觉得防御的内容不是太重要，但是最近一段时间求职的经历和自己了解到的一些情况告诉我，蓝队的内容同样重要，想要真正进入这个行业，不是会几个漏洞，掌握一些工具的使用就可以的，需要的是全面的发展。故给自己开个新坑，专门学习蓝队的内容</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>​\t当需要对web环境进行应急响应时，我们的首要任务应该是获取当前WEB环境的组成架构（语言，数据库，中间件，系统等），然后可以从以下几个角度分析入侵行为</p>\n<ul>\n<li>利用时间节点筛选日志行为</li>\n<li>利用已知对漏洞进行特征筛选</li>\n<li>利用后门查杀进行筛选日志行为</li>\n</ul>\n<p>下面一一解释这三种方法</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>补充：网站被入侵后一般有哪些异常特征</p>\n<p>其实网站被入侵后一般是没有异常的，可能出现的异常一般就是流量异常，因为网站被入侵后，除非攻击者作死，一般不会造成cpu爆满，磁盘爆满，网站很卡这种情况看，因为他的首要目的肯定是潜伏以收集更多的信息，一般入侵者入侵web应用有两个目的，一个是植入后门，把网站进行篡改，如搞黑链，或者提权得到更高的权限，另一种就是拿敏感数据，这两种行为都不会造成服务器有明显的异常，所以还是主要从流量和日志来分析</p></blockquote>\n<h2 id=\"利用时间节点筛选日志\"><a href=\"#利用时间节点筛选日志\" class=\"headerlink\" title=\"利用时间节点筛选日志\"></a>利用时间节点筛选日志</h2><p><strong>背景交代：</strong>一般是某公司在某个时间点发现网站出现篡改或异常</p>\n<p><strong>思路：</strong>时间节点是很重要的线索，如果是设备报警，一般会直接告诉我们什么时间产生了什么东西，线索很明确，另一种就是公司，或者说管理员发现了异常，然后反馈到我们这里来进行处置，这里最好的情况下他会告诉我们是什么时间节点发现的异常，我们可以通过日志进行分析，如果没有时间节点，可以参考接下来的几种方法</p>\n<h4 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h4><p>IIS&amp;.NET-注入-基于时间配合日志分析</p>\n<p>案例已告知了系统出现异常的时间了，所以我们直接配合日志进行分析</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230418104022295.png\" alt=\"image-20230418104022295\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">IIS日志查看方法：\n\niis日志查看方法一：Windows默认文件夹\n\n由于不同的 Windows 版本，iis日志路径不一样，所以分别介绍如下：\nWindows Server 2003 iis 6日志路径：C:\\Windows\\System32\\LogFiles\nWindows Server 2008 R2、2012、2016、2019 iis7以上日志路径：C:\\inetpub\\logs\\LogFiles\nC盘为系统盘。由于每个网站，iis 都会自动生成一个保存日志的文件夹，所以具体iis日志位置在 LogFiles文件夹中的一个子文件夹里，例如：C:\\Windows\\System32\\LogFiles\\W3SVC2 和 C:\\inetpub\\logs\\LogFiles\\W3SVC1。\n\niis日志查看方法二：iis管理器查看\n\n1、选择“开始”菜单 → 管理工具（或 Windows 管理工具） → Internet 信息服务(IIS)管理器（或 Internet Information Services (IIS)管理器），打开 iis 服务器窗口，依次展开要查看日志的网站，Windows Server 2008 R2、2012、2016、2019 系统，双击“日志”图标\nWindows Server 2008 R2、2012、2016、2019 系统：双击“日志”图标；\nWindows Server 2003：右键要查看日志的网站 → 属性 → “网站”选项卡 → 属性 → “常规”选项卡。\n\n“目录”下边的 %SystemDrive%\\inetpub\\logs\\LogFiles 就是日志保存目录，该路径具体就是 C:\\inetpub\\logs\\LogFiles；Windows 2003 就是 C:\\Windows\\System32\\LogFiles。\n\n提示：按 Windows 徽标键（四方块） + R，打开“运行”窗口，把 %SystemDrive%\\inetpub\\logs\\LogFiles 复制到输入框中，按回车，可打开日志所在文件夹。</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230418104749408.png\" alt=\"image-20230418104749408\"></p>\n<p>日志中如何判断攻击行为呢</p>\n<p>主要是看<code>访问的路径，访问的方法，访问的时间，UA头，状态码</code></p>\n<p>找到甲方告知的异常时间节点</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230418105606856.png\" alt=\"image-20230418105606856\"></p>\n<p>可以看到很多访问路径的请求，明显就是扫描网站目录</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/image-20230418105721094.png\" alt=\"image-20230418105721094\"></p>\n<p>接着分析就会发现有sqlmap的注入行为，确认是攻击行为</p>\n<p>确认攻击行为后就可以接着分析看入侵者具体做了什么事了（可以复现入侵者的行为查看对方获取到了哪些信息）</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>补充：隐藏sqlmap攻击UA头的办法</p>\n<p>在浏览器提交正常的请求后抓包，把抓到的这个包放在sqlmap里跑就可以让UA头变成正常浏览器的UA头</p></blockquote>\n","feature":true,"text":"前言​ 之前学习过程中，重点都是放在了web渗透和攻击这一块，觉得防御的内容不是太重要，但是最近一段时间求职的经历和自己了解到的一些情况告诉我，蓝队的内容同样重要，想要真正进入这个行业，不是会几个漏洞，掌握一些工具的使用就可以的，需要的是全面的发展。故给自己开个新坑，专门学习蓝队...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":12,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"蓝队","slug":"蓝队","count":2,"path":"api/tags/蓝队.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">思路</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%97%B6%E9%97%B4%E8%8A%82%E7%82%B9%E7%AD%9B%E9%80%89%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">利用时间节点筛选日志</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">案例</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"蓝队学习笔记-应急相应","uid":"867d6d15fbad01c0968c362d896d2acf","slug":"蓝队-应急响应","date":"2023-04-17T06:30:02.982Z","updated":"2023-04-17T07:38:06.370Z","comments":true,"path":"api/articles/蓝队-应急响应.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/wallhaven-p9o7o9.png","text":"前言​ 之前学习过程中，重点都是放在了web渗透和攻击这一块，觉得防御的内容不是太重要，但是最近一段时间求职的经历和自己了解到的一些情况告诉我，蓝队的内容同样重要，想要真正进入这个行业，不是会几个漏洞，掌握一些工具的使用就可以的，需要的是全面的发展。故给自己开个新坑，专门学习蓝队...","link":"","photos":[],"count_time":{"symbolsCount":782,"symbolsTime":"1 mins."},"categories":[{"name":"学习笔记","slug":"学习笔记","count":12,"path":"api/categories/学习笔记.json"}],"tags":[{"name":"蓝队","slug":"蓝队","count":2,"path":"api/tags/蓝队.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"feature":true}}